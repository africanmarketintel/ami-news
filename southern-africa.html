<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Southern Africa | African Market Intelligence</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,800;1,400;1,600&family=Spectral:ital,wght@0,300;0,400;0,600;1,300;1,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">

<!-- ‚úÖ CREDENTIALS: Edit config.js once ‚Äî applies to all pages -->
<script src="config.js"></script>

<style>
:root{--gold:#C9A84C;--gold-light:#F9C53D;--gold-pale:#FDF6E3;--terra:#B85C38;--terra-dark:#8C3A1F;--green:#1E6B3C;--green-mid:#2E9B5E;--ink:#1A1208;--ink-mid:#3D2B1F;--ink-soft:#6B5344;--cream:#FAF7F0;--cream-dark:#F0EAD9;--border:#D4C4A0;--bg:var(--cream);--surface:#fff;--text:var(--ink);--text-soft:var(--ink-soft);--nav-bg:#0A1A10;--nav-text:var(--cream);--header-bg:var(--cream-dark);--divider:var(--border);--card-bg:#fff}
[data-theme="dark"]{--green:#2E9B5E;--green-mid:#4DBA7F;--bg:#060F09;--surface:#0A1A10;--text:#EDE5D5;--text-soft:#A89070;--nav-bg:#060F09;--nav-text:#EDE5D5;--header-bg:#0A1A10;--divider:#1A3020;--card-bg:#0F2015;--border:#1A3020;--gold-pale:#0D1F12}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Spectral',Georgia,serif;background:var(--bg);color:var(--text);font-size:16px;line-height:1.6;transition:background .3s,color .3s;overflow-x:hidden}
a{color:inherit;text-decoration:none}button{cursor:pointer;border:none;background:none;font-family:inherit}
/* Ticker */
.ticker-bar{background:var(--nav-bg);color:#C9A84C;font-family:'DM Mono',monospace;font-size:11px;padding:6px 0;overflow:hidden;white-space:nowrap}
.ticker-inner{display:inline-flex;gap:48px;animation:ticker 40s linear infinite}
.ticker-item{display:flex;gap:8px;align-items:center}.ticker-item .sym{color:#888}
.up{color:#2E9B5E}.dn{color:#F44336}
@keyframes ticker{from{transform:translateX(0)}to{transform:translateX(-50%)}}
/* Nav */
.top-nav{background:var(--nav-bg);color:var(--nav-text);padding:0 24px;display:flex;align-items:center;justify-content:space-between;height:48px;border-bottom:2px solid var(--gold);position:sticky;top:0;z-index:1000}
.nav-left{display:flex;align-items:center}
.nav-link{color:var(--nav-text);font-family:'DM Mono',monospace;font-size:11px;letter-spacing:.08em;text-transform:uppercase;padding:0 14px;height:48px;display:flex;align-items:center;border-right:1px solid #333;transition:color .2s}.nav-link:visited{color:var(--nav-text)}
.nav-link:first-child{border-left:1px solid #333}.nav-link:hover{color:var(--gold)}
.nav-right{display:flex;align-items:center;gap:10px}
.nav-search{background:rgba(255,255,255,.08);border:1px solid #444;color:var(--nav-text);padding:6px 12px;border-radius:2px;font-family:'DM Mono',monospace;font-size:11px;width:160px;outline:none}
.nav-search:focus{border-color:var(--gold)}.nav-search::placeholder{color:#777}
.btn-subscribe{background:var(--gold);color:var(--ink);font-family:'DM Mono',monospace;font-size:11px;font-weight:500;letter-spacing:.08em;text-transform:uppercase;padding:8px 16px;border-radius:2px;transition:background .2s;display:inline-block}
.btn-subscribe:hover{background:var(--gold-light)}
.dark-toggle{color:var(--nav-text);font-size:16px;padding:8px;line-height:1;transition:color .2s}
.dark-toggle:hover{color:var(--gold)}
.admin-btn{background:var(--terra);color:white;font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.1em;text-transform:uppercase;padding:7px 12px;border-radius:2px;transition:background .2s}
.admin-btn:hover{background:var(--terra-dark)}
/* Masthead */
.masthead{background:var(--header-bg);border-bottom:1px solid var(--divider);padding:20px 24px 16px;text-align:center;position:relative;overflow:hidden}
.masthead::before{content:'';position:absolute;inset:0;background:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none'%3E%3Cg fill='%23C9A84C' fill-opacity='0.04'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")}
.masthead-name{font-family:'Playfair Display',serif;font-size:clamp(28px,6vw,60px);font-weight:800;letter-spacing:-.02em;color:var(--text);line-height:1;position:relative}
.masthead-name span{color:var(--gold)}
.masthead-tagline{font-family:'DM Mono',monospace;font-size:11px;letter-spacing:.2em;text-transform:uppercase;color:var(--text-soft);margin-top:6px;position:relative}
.masthead-meta{display:flex;justify-content:space-between;align-items:center;margin-top:14px;padding-top:12px;border-top:1px solid var(--divider);font-family:'DM Mono',monospace;font-size:10px;color:var(--text-soft);text-transform:uppercase;letter-spacing:.1em;position:relative}
.edition-badge{background:var(--terra);color:white;padding:2px 10px;font-size:10px;letter-spacing:.15em}
/* Section nav */
.section-nav{border-bottom:2px solid var(--gold);background:var(--surface);overflow-x:auto;scrollbar-width:none}
.section-nav-inner{display:flex;padding:0 24px}
.section-tab{font-family:'DM Mono',monospace;font-size:11px;letter-spacing:.08em;text-transform:uppercase;color:var(--text-soft);padding:12px 18px;border-bottom:3px solid transparent;margin-bottom:-2px;white-space:nowrap;cursor:pointer;transition:color .2s,border-color .2s}
.section-tab:hover,.section-tab.active{color:var(--terra);border-bottom-color:var(--terra)}
/* Layout */
.main-wrapper{max-width:1280px;margin:0 auto;padding:32px 24px;display:grid;grid-template-columns:1fr 300px;gap:40px}
@media(max-width:900px){.main-wrapper{grid-template-columns:1fr}}
/* Hero */
.hero-grid{display:grid;grid-template-columns:2fr 1fr;grid-template-rows:auto auto;gap:1px;background:var(--divider);border:1px solid var(--divider);margin-bottom:32px}
.hero-main{grid-column:1;grid-row:1/3;background:var(--card-bg);padding:0;position:relative;overflow:hidden}
.hero-main::after{content:'';position:absolute;bottom:0;left:0;right:0;height:4px;background:linear-gradient(90deg,var(--terra),var(--gold))}
.hero-img{width:100%;height:220px;object-fit:cover;display:block}
.hero-img-placeholder{width:100%;height:220px;background:linear-gradient(135deg,var(--ink),var(--ink-mid));display:flex;align-items:center;justify-content:center;font-family:'DM Mono',monospace;font-size:11px;color:#555;letter-spacing:.1em}
.hero-content{padding:24px 28px 28px}
.hero-side-1,.hero-side-2{background:var(--card-bg);padding:20px 22px;position:relative;overflow:hidden}
.hero-side-1{border-bottom:1px solid var(--divider)}
.side-img{width:100%;height:110px;object-fit:cover;display:block;margin-bottom:12px}
.article-kicker{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.15em;text-transform:uppercase;color:var(--gold);margin-bottom:8px}
.article-section{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.15em;text-transform:uppercase;color:var(--terra);margin-bottom:10px;display:flex;align-items:center;gap:8px}
.article-section::after{content:'';flex:1;height:1px;background:var(--divider)}
.hero-headline{font-family:'Playfair Display',serif;font-size:clamp(20px,3vw,34px);font-weight:700;line-height:1.2;color:var(--text);margin-bottom:14px;transition:color .2s;cursor:pointer}
.hero-headline:hover{color:var(--terra)}
.hero-standfirst{font-size:15px;line-height:1.65;color:var(--text-soft);margin-bottom:16px;font-style:italic;font-weight:300}
.side-headline{font-family:'Playfair Display',serif;font-size:17px;font-weight:600;line-height:1.3;margin-bottom:10px;transition:color .2s;cursor:pointer}
.side-headline:hover{color:var(--terra)}
.side-standfirst{font-size:13px;color:var(--text-soft);line-height:1.6;font-weight:300}
.article-meta{font-family:'DM Mono',monospace;font-size:10px;color:var(--text-soft);display:flex;gap:14px;align-items:center;flex-wrap:wrap}
.article-meta .author{color:var(--terra)}
.article-tag{background:var(--gold-pale);color:var(--ink-mid);padding:2px 8px;font-size:9px;letter-spacing:.1em;text-transform:uppercase;border-left:2px solid var(--gold)}
[data-theme="dark"] .article-tag{background:#0D1F12;color:var(--gold-light)}
/* Cards */
.article-row{display:grid;grid-template-columns:repeat(3,1fr);gap:1px;background:var(--divider);border:1px solid var(--divider);margin-bottom:24px}
.article-card{background:var(--card-bg);padding:0;transition:background .2s;overflow:hidden}
.article-card:hover{background:var(--gold-pale)}
[data-theme="dark"] .article-card:hover{background:#0D1F12}
.card-img{width:100%;height:140px;object-fit:cover;display:block}
.card-img-placeholder{width:100%;height:140px;background:linear-gradient(135deg,var(--ink-mid),var(--ink));display:flex;align-items:center;justify-content:center;font-size:24px;opacity:.4}
.card-content{padding:18px}
.card-headline{font-family:'Playfair Display',serif;font-size:16px;font-weight:600;line-height:1.35;margin-bottom:10px;margin-top:8px;cursor:pointer;transition:color .2s}
.card-headline:hover{color:var(--terra)}
.card-body{font-size:13px;color:var(--text-soft);line-height:1.65;margin-bottom:14px;font-weight:300}
.card-footer{font-family:'DM Mono',monospace;font-size:10px;color:var(--text-soft);display:flex;justify-content:space-between;align-items:center}
.lock-icon{color:var(--gold)}
/* Markets */
.markets-strip{background:var(--card-bg);border:1px solid var(--divider);border-top:3px solid var(--gold);padding:20px 24px;margin-bottom:32px}
.strip-title{font-family:'DM Mono',monospace;font-size:11px;letter-spacing:.15em;text-transform:uppercase;color:var(--text-soft);margin-bottom:16px}
.markets-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:16px}
.market-name{font-family:'DM Mono',monospace;font-size:10px;color:var(--text-soft);text-transform:uppercase;letter-spacing:.08em;margin-bottom:4px}
.market-value{font-family:'DM Mono',monospace;font-size:17px;font-weight:500;color:var(--text);line-height:1}
.market-change{font-family:'DM Mono',monospace;font-size:11px;margin-top:3px}
/* Opinion */
.opinion-row{display:grid;grid-template-columns:repeat(3,1fr);gap:1px;background:var(--divider);border:1px solid var(--divider);margin-bottom:32px}
.opinion-card{background:var(--card-bg);padding:22px;border-top:3px solid var(--terra)}
.opinion-label{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:.2em;text-transform:uppercase;color:var(--terra);margin-bottom:10px}
.opinion-author{font-family:'DM Mono',monospace;font-size:11px;color:var(--text-soft);margin-bottom:10px;display:flex;align-items:center;gap:10px}
.author-avatar{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Playfair Display',serif;font-size:13px;font-weight:800;color:white;flex-shrink:0;object-fit:cover}
.opinion-headline{font-family:'Playfair Display',serif;font-size:16px;font-style:italic;line-height:1.4;margin-bottom:10px;cursor:pointer}
.opinion-headline:hover{color:var(--terra)}
/* Sidebar */
.sidebar-widget{border:1px solid var(--divider);border-top:3px solid var(--gold);background:var(--card-bg);padding:20px;margin-bottom:24px}
.widget-title{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.15em;text-transform:uppercase;color:var(--text-soft);margin-bottom:14px;padding-bottom:10px;border-bottom:1px solid var(--divider)}
.top-story{padding:10px 0;border-bottom:1px solid var(--divider)}.top-story:last-child{border-bottom:none;padding-bottom:0}
.top-story-num{font-family:'DM Mono',monospace;font-size:22px;font-weight:500;color:var(--divider);line-height:1;margin-bottom:3px}
.top-story-headline{font-family:'Playfair Display',serif;font-size:13px;font-weight:600;line-height:1.35;cursor:pointer;transition:color .2s}
.top-story-headline:hover{color:var(--terra)}
.newsletter-widget{background:linear-gradient(135deg,#0A1A10,#1A3020);padding:24px;margin-bottom:24px;position:relative;overflow:hidden}
.newsletter-widget::before{content:'‚óÜ';position:absolute;top:-20px;right:-10px;font-size:120px;color:rgba(201,168,76,.08);line-height:1}
.nw-title{font-family:'Playfair Display',serif;font-size:18px;color:var(--gold);margin-bottom:6px;position:relative}
.nw-sub{font-size:13px;color:#999;margin-bottom:12px;font-weight:300;position:relative}
.nw-input{width:100%;background:rgba(255,255,255,.08);border:1px solid #444;color:white;padding:9px 12px;border-radius:2px;font-family:'DM Mono',monospace;font-size:11px;margin-bottom:8px;outline:none}
.nw-input::placeholder{color:#666}
.nw-btn{width:100%;background:var(--gold);color:var(--ink);font-family:'DM Mono',monospace;font-size:11px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;padding:9px;border-radius:2px}
.nw-btn:hover{background:var(--gold-light)}
.data-row{display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid var(--divider);font-family:'DM Mono',monospace;font-size:11px}
.data-row:last-child{border-bottom:none}
.data-label{color:var(--text-soft)}.data-value{font-weight:500}
.section-header{display:flex;align-items:center;gap:16px;margin-bottom:16px}
.section-title{font-family:'Playfair Display',serif;font-size:20px;font-weight:700;white-space:nowrap}
.section-line{flex:1;height:1px;background:var(--divider)}
.view-more{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.1em;text-transform:uppercase;color:var(--terra);white-space:nowrap}
.view-more:hover{color:var(--gold)}
/* Breaking */
.breaking-banner{background:var(--terra);color:white;padding:10px 24px;display:flex;align-items:center;gap:16px;font-size:13px}
.breaking-label{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.2em;text-transform:uppercase;background:rgba(255,255,255,.2);padding:3px 10px;flex-shrink:0}
.breaking-close{margin-left:auto;color:rgba(255,255,255,.7);font-size:18px;padding:0 4px}
/* Loading skeleton */
.skeleton{background:linear-gradient(90deg,var(--divider) 25%,var(--card-bg) 50%,var(--divider) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:2px}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
.skel-headline{height:28px;margin-bottom:12px;width:85%}
.skel-text{height:14px;margin-bottom:8px;width:100%}
.skel-text-short{height:14px;width:60%}
/* Paywall */
.paywall-blur{position:fixed;bottom:0;left:0;right:0;height:45vh;background:linear-gradient(to top,var(--bg) 60%,transparent);pointer-events:none;z-index:1999;display:none}
.paywall-overlay{position:fixed;inset:0;z-index:2000;display:none;align-items:flex-end;justify-content:center}
.paywall-box{background:var(--surface);border:1px solid var(--divider);border-top:4px solid var(--gold);box-shadow:0 -8px 48px rgba(0,0,0,.15);padding:40px;max-width:600px;width:90%;margin-bottom:32px;text-align:center;animation:slideUp .5s ease}
@keyframes slideUp{from{transform:translateY(40px);opacity:0}to{transform:translateY(0);opacity:1}}
.paywall-logo{font-family:'Playfair Display',serif;font-size:20px;font-weight:800;color:var(--text);margin-bottom:4px}
.paywall-logo span{color:var(--gold)}
.paywall-headline{font-family:'Playfair Display',serif;font-size:24px;font-weight:700;margin-bottom:10px;line-height:1.3}
.paywall-sub{font-size:14px;color:var(--text-soft);margin-bottom:24px;font-style:italic;font-weight:300}
.paywall-plans{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px}
.plan-card{border:1px solid var(--divider);padding:18px;text-align:left;position:relative;transition:border-color .2s}
.plan-card:hover{border-color:var(--gold)}
.plan-card.featured{border-color:var(--gold);background:var(--gold-pale)}
[data-theme="dark"] .plan-card.featured{background:#0D1F12}
.plan-badge{position:absolute;top:-10px;right:14px;background:var(--terra);color:white;font-family:'DM Mono',monospace;font-size:9px;letter-spacing:.1em;text-transform:uppercase;padding:2px 10px}
.plan-name{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.15em;text-transform:uppercase;color:var(--text-soft);margin-bottom:8px}
.plan-price{font-family:'Playfair Display',serif;font-size:24px;font-weight:700;margin-bottom:4px}
.plan-period{font-family:'DM Mono',monospace;font-size:10px;color:var(--text-soft);margin-bottom:12px}
.plan-features{list-style:none;font-size:12px;color:var(--text-soft)}
.plan-features li{padding:3px 0}
.plan-features li::before{content:'‚úì ';color:var(--gold)}
.paywall-cta{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:14px}
.btn-stripe{background:var(--gold);color:var(--ink);font-family:'DM Mono',monospace;font-size:12px;font-weight:500;letter-spacing:.08em;text-transform:uppercase;padding:14px;border-radius:2px;display:block;text-align:center;transition:background .2s}
.btn-stripe:hover{background:var(--gold-light)}
.btn-stripe-alt{background:var(--terra);color:white;font-family:'DM Mono',monospace;font-size:12px;font-weight:500;letter-spacing:.08em;text-transform:uppercase;padding:14px;border-radius:2px;display:block;text-align:center;transition:background .2s}
.btn-stripe-alt:hover{background:var(--terra-dark)}
.paywall-dismiss{font-family:'DM Mono',monospace;font-size:10px;color:var(--text-soft);letter-spacing:.08em;text-transform:uppercase;text-decoration:underline;cursor:pointer}
/* Toast */
.toast{position:fixed;bottom:28px;right:28px;z-index:9999;background:#0D3B1C;border:1px solid #2E9B5E;color:#2E9B5E;font-family:'DM Mono',monospace;font-size:12px;letter-spacing:.08em;padding:12px 22px;border-radius:2px;opacity:0;transform:translateY(16px);transition:all .3s;pointer-events:none}
.toast.show{opacity:1;transform:translateY(0)}

/* ‚ïê‚ïê‚ïê ADMIN PANEL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.admin-overlay{position:fixed;inset:0;z-index:9000;display:none;background:rgba(0,0,0,.55);backdrop-filter:blur(3px)}
.admin-overlay.open{display:flex}
.admin-panel{background:#060F09;color:#EDE5D5;width:500px;height:100vh;overflow-y:auto;display:flex;flex-direction:column;box-shadow:4px 0 40px rgba(0,0,0,.6);border-right:2px solid #C9A84C;flex-shrink:0}
.admin-right{flex:1;background:#0A1A10;overflow-y:auto;padding:28px}
.admin-header{padding:18px 24px;border-bottom:1px solid #1A3020;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:#060F09;z-index:10}
.admin-logo{font-family:'Playfair Display',serif;font-size:18px;color:#C9A84C}
.admin-status{font-family:'DM Mono',monospace;font-size:10px;padding:3px 10px;border-radius:1px;border:1px solid}
.admin-status.connected{color:#2E9B5E;border-color:#2E9B5E;background:rgba(76,175,80,.1)}
.admin-status.disconnected{color:#F44336;border-color:#F44336;background:rgba(244,67,54,.1)}
.admin-status.loading{color:#C9A84C;border-color:#C9A84C;background:rgba(201,168,76,.1)}
.admin-close-btn{color:#888;font-size:22px;padding:4px 8px;transition:color .2s}
.admin-close-btn:hover{color:#C9A84C}
.admin-tabs{display:flex;border-bottom:1px solid #1A3020;padding:0 24px}
.admin-tab{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.12em;text-transform:uppercase;color:#888;padding:12px 14px;border-bottom:2px solid transparent;margin-bottom:-1px;cursor:pointer;transition:color .2s,border-color .2s}
.admin-tab:hover,.admin-tab.active{color:#C9A84C;border-bottom-color:#C9A84C}
.admin-section{display:none;padding:20px 24px}
.admin-section.active{display:block}
.admin-section-title{font-family:'DM Mono',monospace;font-size:11px;letter-spacing:.15em;text-transform:uppercase;color:#C9A84C;margin-bottom:16px;padding-bottom:10px;border-bottom:1px solid #1A3020}
.form-group{margin-bottom:14px}
.form-label{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.1em;text-transform:uppercase;color:#888;margin-bottom:6px;display:block}
.form-input,.form-textarea,.form-select{width:100%;background:#0A1A10;border:1px solid #1A3020;color:#EDE5D5;padding:9px 12px;border-radius:2px;font-family:'Spectral',serif;font-size:14px;outline:none;transition:border-color .2s}
.form-input:focus,.form-textarea:focus,.form-select:focus{border-color:#C9A84C}
.form-textarea{min-height:80px;resize:vertical;line-height:1.6}
.form-select{font-family:'DM Mono',monospace;font-size:12px}.form-select option{background:#0A1A10}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.btn-save{background:#C9A84C;color:#0A1A10;font-family:'DM Mono',monospace;font-size:11px;font-weight:500;letter-spacing:.12em;text-transform:uppercase;padding:12px 24px;border-radius:2px;transition:background .2s;width:100%;margin-top:8px}
.btn-save:hover{background:#F9C53D}
.btn-save:disabled{background:#666;cursor:not-allowed}
.btn-danger{background:#B85C38;color:white;font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.08em;text-transform:uppercase;padding:5px 12px;border-radius:2px;transition:background .2s}
.btn-danger:hover{background:#8C3A1F}
.admin-article-list{list-style:none}
.admin-article-item{border:1px solid #1A3020;border-radius:2px;margin-bottom:8px;overflow:hidden}
.admin-article-header{padding:12px 14px;display:flex;align-items:flex-start;gap:10px;cursor:pointer;transition:background .2s}
.admin-article-header:hover{background:#0D1F12}
.admin-article-info{flex:1;min-width:0}
.admin-article-title{font-family:'Playfair Display',serif;font-size:13px;line-height:1.3;margin-bottom:4px;color:#EDE5D5;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.admin-article-meta{font-family:'DM Mono',monospace;font-size:10px;color:#888;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.admin-article-body{display:none;padding:14px;border-top:1px solid #1A3020;background:#060F09}
.admin-article-body.open{display:block}
.badge{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:.1em;text-transform:uppercase;padding:2px 7px;border-radius:1px}
.badge-hero{background:#B85C38;color:white}.badge-locked{background:#1A3020;color:#C9A84C}
.badge-side1,.badge-side2{background:#1B3A6B;color:white}.badge-card{background:#0D3B1C;color:#2E9B5E}
.market-edit-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.market-edit-item{background:#0A1A10;border:1px solid #1A3020;padding:12px;border-radius:2px}
.market-edit-name{font-family:'DM Mono',monospace;font-size:10px;color:#C9A84C;letter-spacing:.1em;text-transform:uppercase;margin-bottom:8px}
.mini-input{width:100%;background:#060F09;border:1px solid #1A3020;color:#EDE5D5;padding:7px 9px;border-radius:2px;font-family:'DM Mono',monospace;font-size:12px;outline:none;margin-bottom:5px;transition:border-color .2s}
.mini-input:focus{border-color:#C9A84C}
.dir-toggle{display:flex;gap:5px}
.dir-btn{font-family:'DM Mono',monospace;font-size:10px;padding:4px 0;border:1px solid #1A3020;border-radius:1px;color:#888;cursor:pointer;transition:all .2s;flex:1;text-align:center}
.dir-btn.up.active{background:#0D3B1C;border-color:#2E9B5E;color:#2E9B5E}
.dir-btn.dn.active{background:#4D1B1B;border-color:#F44336;color:#F44336}
/* Image upload */
.img-upload-area{border:2px dashed #1A3020;border-radius:2px;padding:20px;text-align:center;cursor:pointer;transition:border-color .2s;position:relative;margin-bottom:10px}
.img-upload-area:hover{border-color:#C9A84C}
.img-upload-area input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.img-upload-label{font-family:'DM Mono',monospace;font-size:10px;color:#888;letter-spacing:.1em;text-transform:uppercase}
.img-preview{width:100%;height:80px;object-fit:cover;border-radius:2px;margin-top:8px;display:none}
.setting-row{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid #1A3020}
.setting-row:last-child{border-bottom:none}
.setting-label{font-family:'DM Mono',monospace;font-size:11px;color:#EDE5D5}
.setting-desc{font-size:12px;color:#888;margin-top:2px}
.toggle-switch{position:relative;width:42px;height:22px;flex-shrink:0}
.toggle-switch input{opacity:0;width:0;height:0}
.toggle-slider{position:absolute;inset:0;background:#1A3020;border-radius:11px;cursor:pointer;transition:.3s}
.toggle-slider::before{content:'';position:absolute;left:3px;top:3px;width:16px;height:16px;background:#888;border-radius:50%;transition:.3s}
.toggle-switch input:checked+.toggle-slider{background:#C9A84C}
.toggle-switch input:checked+.toggle-slider::before{transform:translateX(20px);background:#0A1A10}
/* Dashboard stats */
.stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:24px}
.stat-card{background:#060F09;border:1px solid #1A3020;border-top:2px solid;padding:18px}
.stat-card:nth-child(1){border-top-color:#C9A84C}.stat-card:nth-child(2){border-top-color:#B85C38}
.stat-card:nth-child(3){border-top-color:#2E9B5E}.stat-card:nth-child(4){border-top-color:#1B3A6B}
.stat-num{font-family:'Playfair Display',serif;font-size:30px;font-weight:700;color:#EDE5D5;line-height:1}
.stat-label{font-family:'DM Mono',monospace;font-size:10px;color:#888;letter-spacing:.1em;text-transform:uppercase;margin-top:5px}
/* Footer */
footer{background:var(--nav-bg);color:#888;padding:40px 24px 24px;margin-top:48px}
.footer-inner{max-width:1280px;margin:0 auto}
.footer-top{display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:40px;padding-bottom:40px;border-bottom:1px solid #333;margin-bottom:28px}
@media(max-width:768px){.footer-top{grid-template-columns:1fr 1fr}}
.footer-brand{font-family:'Playfair Display',serif;font-size:22px;font-weight:800;color:var(--gold);margin-bottom:12px}
.footer-about{font-size:13px;line-height:1.7;font-weight:300;max-width:260px}
.footer-col-title{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.2em;text-transform:uppercase;color:var(--gold);margin-bottom:14px}
.footer-links{list-style:none}
.footer-links li{padding:4px 0}
.footer-links a{font-size:13px;transition:color .2s;font-weight:300}
.footer-links a:hover{color:var(--gold)}
.footer-bottom{display:flex;justify-content:space-between;font-family:'DM Mono',monospace;font-size:10px;flex-wrap:wrap;gap:10px}

/* ‚ïê‚ïê‚ïê PAGINATION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.pagination-bar{display:flex;align-items:center;justify-content:center;gap:6px;padding:32px 0 8px;flex-wrap:wrap}
.page-btn{font-family:'DM Mono',monospace;font-size:12px;font-weight:500;letter-spacing:.05em;min-width:38px;height:38px;display:flex;align-items:center;justify-content:center;border:1px solid var(--divider);background:var(--card-bg);color:var(--text-soft);border-radius:2px;cursor:pointer;transition:all .2s;text-decoration:none;padding:0 10px}
.page-btn:hover{border-color:var(--gold);color:var(--gold)}
.page-btn.active{background:var(--terra);border-color:var(--terra);color:white}
.page-btn.disabled{opacity:.35;cursor:not-allowed;pointer-events:none}
.page-btn.nav{background:var(--card-bg)}
.page-ellipsis{font-family:'DM Mono',monospace;font-size:12px;color:var(--text-soft);padding:0 4px;line-height:38px}
.pagination-info{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.1em;text-transform:uppercase;color:var(--text-soft);text-align:center;margin-bottom:4px}
.archive-header{background:var(--card-bg);border:1px solid var(--divider);border-left:4px solid var(--terra);padding:14px 20px;margin-bottom:0;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px}
.archive-title{font-family:'DM Mono',monospace;font-size:11px;letter-spacing:.15em;text-transform:uppercase;color:var(--terra)}
.archive-count{font-family:'DM Mono',monospace;font-size:10px;color:var(--text-soft)}


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   WCAG AA + RESPONSIVE ‚Äî auto-generated patch
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* Screen-reader only ‚Äî hides visually but readable by AT */
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;
  overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

/* Skip link ‚Äî WCAG 2.4.1 Bypass Blocks */
.skip-link{position:absolute;top:-100px;left:8px;z-index:99999;
  background:var(--gold);color:var(--ink);padding:10px 18px;
  font-family:'DM Mono',monospace;font-size:12px;font-weight:600;
  letter-spacing:.08em;text-transform:uppercase;border-radius:2px;
  text-decoration:none;box-shadow:0 4px 12px rgba(0,0,0,.3);
  transition:top .15s}
.skip-link:focus{top:8px}

/* Visible focus rings ‚Äî WCAG 2.4.7 Focus Visible */
*:focus{outline:none}
*:focus-visible{outline:3px solid #C9A84C !important;outline-offset:3px !important}
[data-theme="dark"] *:focus-visible{outline-color:#F9C53D !important}

/* Paywall dismiss was a <div> ‚Äî now <button> */
button.paywall-dismiss{background:none;border:none;padding:8px 4px;
  font-family:'DM Mono',monospace;font-size:10px;color:var(--text-soft);
  letter-spacing:.08em;text-transform:uppercase;text-decoration:underline;
  cursor:pointer;min-height:44px}

/* Minimum 44√ó44 touch targets ‚Äî WCAG 2.5.5 */
.dark-toggle{min-width:44px;min-height:44px;display:inline-flex;
  align-items:center;justify-content:center}
.breaking-close{min-width:44px;min-height:44px;display:inline-flex;
  align-items:center;justify-content:center}
.admin-close-btn{min-width:44px;min-height:44px;display:inline-flex;
  align-items:center;justify-content:center}
.page-btn{min-width:44px;min-height:44px}
.section-tab{min-height:44px}
.nw-btn{min-height:44px}
.btn-save{min-height:44px}

/* Footer link contrast fix ‚Äî WCAG 1.4.3 (was #888 on dark bg ‚âà 3.5:1, fails) */
footer .footer-links a{color:#B0ADC8 !important}
footer .footer-links a:hover{color:var(--gold) !important}
.footer-about{color:#A89070}
.footer-bottom{color:#999}

/* ‚îÄ‚îÄ Mobile hamburger button ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.nav-hamburger{display:none;flex-direction:column;align-items:center;
  justify-content:center;gap:5px;width:44px;height:48px;padding:0 10px;
  cursor:pointer;background:none;border:none;color:var(--nav-text);
  flex-shrink:0}
.nav-hamburger span{display:block;width:20px;height:2px;background:currentColor;
  border-radius:1px;transition:transform .25s,opacity .25s}
.nav-hamburger[aria-expanded="true"] span:nth-child(1){transform:translateY(7px) rotate(45deg)}
.nav-hamburger[aria-expanded="true"] span:nth-child(2){opacity:0;transform:scaleX(0)}
.nav-hamburger[aria-expanded="true"] span:nth-child(3){transform:translateY(-7px) rotate(-45deg)}

/* ‚îÄ‚îÄ Mobile nav drawer ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.nav-mobile-drawer{display:none;position:fixed;top:48px;left:0;right:0;
  bottom:0;background:var(--nav-bg);z-index:998;overflow-y:auto;
  border-top:2px solid var(--gold)}
.nav-mobile-drawer.open{display:block}
.nav-mobile-drawer a,.nav-mobile-drawer button{display:flex;align-items:center;
  width:100%;padding:14px 24px;font-family:'DM Mono',monospace;font-size:12px;
  letter-spacing:.08em;text-transform:uppercase;color:var(--nav-text);
  border-bottom:1px solid rgba(255,255,255,.07);text-decoration:none;
  min-height:50px;background:none;border-left:none;border-right:none;
  border-top:none;cursor:pointer}
.nav-mobile-drawer a:hover,.nav-mobile-drawer a:focus,
.nav-mobile-drawer button:hover,.nav-mobile-drawer button:focus{
  background:#0A1A10;color:var(--gold)}
.nav-mobile-drawer a.mob-active{color:var(--gold)}
.nav-mobile-search{padding:12px 24px;border-bottom:1px solid rgba(255,255,255,.07)}
.nav-mobile-search input{width:100%;background:rgba(255,255,255,.08);
  border:1px solid #444;color:var(--nav-text);padding:10px 14px;
  font-family:'DM Mono',monospace;font-size:12px;border-radius:2px}
.nav-mobile-search input:focus{border-color:var(--gold)}
.mob-subscribe{background:var(--gold) !important;color:var(--ink) !important;
  margin:16px 24px;border-radius:2px;justify-content:center;
  font-weight:600;width:calc(100% - 48px) !important;border-bottom:none !important}

/* ‚ïê‚ïê‚ïê RESPONSIVE BREAKPOINTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* ‚îÄ‚îÄ Mobile (< 768px) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
@media(max-width:767px){

  /* Hamburger on, desktop nav links off */
  .nav-hamburger{display:flex !important}
  .nav-left,.nav-right{display:none !important}

  /* Hero: single column stack */
  .hero-grid{display:flex !important;flex-direction:column !important}
  .hero-main,.hero-side-1,.hero-side-2{width:100%;border-right:none;
    border-bottom:1px solid var(--divider)}

  /* Cards: 1 column */
  .article-row{grid-template-columns:1fr !important}

  /* Opinion: 1 column */
  .opinion-row{grid-template-columns:1fr !important}

  /* Most-read: 1 column */
  #mostReadContainer{grid-template-columns:1fr !important}

  /* Masthead meta: centred stack */
  .masthead-meta{flex-direction:column;gap:6px;text-align:center;align-items:center}
  .masthead{padding:16px 16px 12px}

  /* Paywall: stacked */
  .paywall-plans,.paywall-cta{grid-template-columns:1fr !important}
  .paywall-box{padding:24px 18px;margin-bottom:0;border-left:none;border-right:none;
    border-bottom:none;border-radius:0}
  .paywall-overlay{align-items:flex-end}

  /* Admin panel full-width */
  .admin-panel{width:100vw !important;max-width:100vw !important}

  /* Forms stack */
  .form-row{grid-template-columns:1fr !important}
  .market-edit-grid{grid-template-columns:1fr !important}

  /* Footer: full single column */
  .footer-top{grid-template-columns:1fr !important}
  .footer-about{max-width:100% !important}
  .footer-bottom{flex-direction:column;gap:6px;text-align:center}

  /* Padding reduction */
  .main-wrapper{padding:20px 16px !important}
  .hero-content{padding:18px 16px 20px}
  .card-content{padding:14px}

  /* Markets: 2-col on mobile */
  .markets-grid{grid-template-columns:repeat(2,1fr) !important}

  /* Section header wraps */
  .section-header{flex-wrap:wrap;gap:6px}

  /* Archive filter wraps */
  .archive-filter-bar{flex-wrap:wrap !important;gap:6px !important}

  /* Ticker slightly smaller */
  .ticker-inner{gap:28px}

  /* Article page reading width */
  .article-body{padding:0 !important}
}

/* ‚îÄ‚îÄ Tablet (768px ‚Äì 1024px) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
@media(min-width:768px) and (max-width:1024px){

  /* 2-column cards */
  .article-row{grid-template-columns:1fr 1fr !important}
  .opinion-row{grid-template-columns:1fr 1fr !important}
  #mostReadContainer{grid-template-columns:1fr 1fr !important}

  /* Hero ratio tweak */
  .hero-grid{grid-template-columns:3fr 2fr !important}

  /* Wrapper padding */
  .main-wrapper{padding:24px 20px}

  /* Footer: 2-col */
  .footer-top{grid-template-columns:1fr 1fr !important}

  /* Reduce nav font on tablet */
  .nav-link{font-size:10px !important;padding:0 10px !important}
}


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INLINE EDIT MODE ‚Äî Squarespace-style
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* ‚îÄ‚îÄ Floating Edit FAB ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.ami-edit-fab{
  position:fixed;bottom:80px;right:22px;z-index:8900;
  background:var(--gold);color:var(--ink);
  font-family:'DM Mono',monospace;font-size:11px;font-weight:700;
  letter-spacing:.1em;text-transform:uppercase;
  padding:11px 20px;border-radius:30px;cursor:pointer;
  box-shadow:0 4px 24px rgba(0,0,0,.35);
  transition:all .2s;border:none;
  display:none;align-items:center;gap:8px;
}
.ami-edit-fab:hover{background:var(--gold-light);transform:translateY(-2px);box-shadow:0 6px 28px rgba(0,0,0,.4)}
.ami-edit-fab.active{background:var(--terra);color:white}
.ami-edit-fab .fab-dot{width:7px;height:7px;border-radius:50%;background:rgba(0,0,0,.3);transition:background .2s}
.ami-edit-fab.active .fab-dot{background:rgba(255,255,255,.4);animation:fab-pulse 1.5s infinite}
@keyframes fab-pulse{0%,100%{opacity:1}50%{opacity:.3}}

/* ‚îÄ‚îÄ Save Bar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.ami-edit-bar{
  position:fixed;bottom:0;left:0;right:0;z-index:8901;
  background:#060F09;border-top:3px solid var(--gold);
  padding:10px 24px;display:none;align-items:center;gap:16px;
  font-family:'DM Mono',monospace;font-size:11px;
  box-shadow:0 -4px 24px rgba(0,0,0,.4);
  transform:translateY(100%);transition:transform .25s;
}
.ami-edit-bar.visible{display:flex;transform:translateY(0)}
.ami-edit-bar-label{color:#C9A84C;letter-spacing:.12em;text-transform:uppercase;flex:1}
.ami-edit-pending{color:#F44336;font-size:10px;letter-spacing:.08em}
.ami-edit-pending.none{color:#2E9B5E}
.ami-save-btn{background:var(--gold);color:var(--ink);font-family:'DM Mono',monospace;
  font-size:10px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;
  padding:8px 18px;border-radius:2px;border:none;cursor:pointer}
.ami-save-btn:hover{background:var(--gold-light)}
.ami-exit-btn{background:transparent;border:1px solid #1A3020;color:#888;
  font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.1em;text-transform:uppercase;
  padding:8px 14px;border-radius:2px;cursor:pointer;transition:all .2s}
.ami-exit-btn:hover{border-color:#C9A84C;color:#C9A84C}

/* ‚îÄ‚îÄ Editable elements ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
body.ami-edit-mode [data-editable]{
  cursor:text;
  border-radius:3px;
  transition:outline .15s,background .15s;
  position:relative;
}
body.ami-edit-mode [data-editable]:not([data-editable="image"])::before{
  content:'‚úè';
  position:absolute;
  top:-10px;right:-4px;
  font-size:9px;
  background:var(--gold);color:var(--ink);
  padding:1px 4px;border-radius:2px;
  opacity:0;transition:opacity .15s;
  pointer-events:none;
  font-style:normal;
}
body.ami-edit-mode [data-editable]:hover::before{opacity:1}
body.ami-edit-mode [data-editable]:hover{
  outline:2px dashed #C9A84C;
  outline-offset:4px;
}
body.ami-edit-mode [data-editable]:focus,[data-editable]:focus-within{
  outline:2px solid #C9A84C !important;
  outline-offset:4px;
  background:rgba(201,168,76,.05);
}
body.ami-edit-mode [data-editable].saved-flash{
  outline:2px solid #2E9B5E !important;
  background:rgba(76,175,80,.06);
  transition:outline .1s,background .1s;
}

/* ‚îÄ‚îÄ Image overlay ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
body.ami-edit-mode [data-editable="image"]{
  cursor:pointer !important;
  position:relative;
  display:block;
}
body.ami-edit-mode [data-editable="image"]::after{
  content:'üì∑  Replace Image';
  position:absolute;inset:0;
  background:rgba(15,10,6,.72);
  color:#C9A84C;
  font-family:'DM Mono',monospace;font-size:11px;letter-spacing:.12em;
  text-transform:uppercase;
  display:flex;align-items:center;justify-content:center;
  opacity:0;transition:opacity .2s;
  pointer-events:none;
}
body.ami-edit-mode [data-editable="image"]:hover::after{opacity:1}

/* ‚îÄ‚îÄ Article card "Edit" button ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.card-edit-overlay{
  display:none;
  position:absolute;top:8px;right:8px;z-index:20;
  background:var(--gold);color:var(--ink);
  font-family:'DM Mono',monospace;font-size:9px;font-weight:700;
  letter-spacing:.1em;text-transform:uppercase;
  padding:4px 10px;border-radius:2px;border:none;cursor:pointer;
  box-shadow:0 2px 8px rgba(0,0,0,.3);
}
body.ami-edit-mode .card-edit-overlay{display:flex;align-items:center;gap:4px}
body.ami-edit-mode .article-card,.ami-edit-mode .hero-main,
.ami-edit-mode .hero-side-1,.ami-edit-mode .hero-side-2{position:relative}

/* ‚îÄ‚îÄ Image replace dialog ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.ami-img-dialog{
  display:none;position:fixed;inset:0;z-index:9999;
  background:rgba(0,0,0,.7);backdrop-filter:blur(4px);
  align-items:center;justify-content:center;
}
.ami-img-dialog.open{display:flex}
.ami-img-dialog-box{
  background:#0A1A10;border:1px solid #1A3020;border-top:4px solid #C9A84C;
  padding:28px;max-width:480px;width:90%;border-radius:2px;
  box-shadow:0 8px 40px rgba(0,0,0,.6);
}
.ami-img-dialog-title{font-family:'DM Mono',monospace;font-size:11px;letter-spacing:.15em;
  text-transform:uppercase;color:#C9A84C;margin-bottom:16px}
.ami-img-dialog-preview{width:100%;height:140px;object-fit:cover;border-radius:2px;
  margin-bottom:14px;display:none;border:1px solid #1A3020}
.ami-img-dialog-tabs{display:flex;gap:1px;margin-bottom:14px;background:#060F09;border-radius:2px;overflow:hidden}
.ami-img-tab{flex:1;padding:8px;font-family:'DM Mono',monospace;font-size:10px;
  letter-spacing:.1em;text-transform:uppercase;color:#888;cursor:pointer;
  background:transparent;border:none;transition:all .2s;text-align:center}
.ami-img-tab.active{background:#1A3020;color:#C9A84C}
.ami-img-panel{display:none}.ami-img-panel.active{display:block}
.ami-img-url{width:100%;background:#060F09;border:1px solid #1A3020;color:#EDE5D5;
  padding:9px 12px;font-family:'DM Mono',monospace;font-size:12px;border-radius:2px;
  outline:none;margin-bottom:10px}
.ami-img-url:focus{border-color:#C9A84C}
.ami-img-upload-area{border:2px dashed #1A3020;border-radius:2px;padding:24px;
  text-align:center;cursor:pointer;position:relative;transition:border-color .2s;margin-bottom:10px}
.ami-img-upload-area:hover{border-color:#C9A84C}
.ami-img-upload-area input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.ami-img-upload-label{font-family:'DM Mono',monospace;font-size:10px;color:#888;letter-spacing:.1em;text-transform:uppercase}
.ami-img-dialog-actions{display:flex;gap:8px;margin-top:4px}
.ami-img-apply{flex:1;background:#C9A84C;color:#0A1A10;font-family:'DM Mono',monospace;
  font-size:10px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;
  padding:10px;border:none;border-radius:2px;cursor:pointer}
.ami-img-apply:hover{background:#F9C53D}
.ami-img-cancel{background:transparent;border:1px solid #1A3020;color:#888;
  font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.1em;text-transform:uppercase;
  padding:10px 14px;border-radius:2px;cursor:pointer;transition:all .2s}
.ami-img-cancel:hover{border-color:#C9A84C;color:#C9A84C}

/* ‚îÄ‚îÄ Rich text toolbar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.ami-rte-bar{
  display:none;
  position:fixed;top:60px;left:50%;transform:translateX(-50%);z-index:9000;
  background:#0A1A10;border:1px solid #1A3020;border-radius:4px;
  padding:4px 6px;gap:2px;box-shadow:0 4px 20px rgba(0,0,0,.5);
  align-items:center;
  font-family:'DM Mono',monospace;font-size:11px;
}
.ami-rte-bar.visible{display:flex}
.ami-rte-btn{background:none;border:none;color:#888;padding:5px 8px;border-radius:2px;
  cursor:pointer;font-size:14px;line-height:1;transition:all .2s;min-width:30px;text-align:center}
.ami-rte-btn:hover{background:#1A3020;color:#C9A84C}
.ami-rte-sep{width:1px;height:18px;background:#1A3020;margin:0 3px}

.region-label{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:.15em;text-transform:uppercase;color:var(--text-soft);padding:0 14px 0 2px;display:flex;align-items:center;opacity:.55;flex-shrink:0;user-select:none;pointer-events:none}
.paywall-overlay,.paywall-blur{display:none!important}.lock-icon{display:none!important}.badge-locked{display:none!important}

/* ‚îÄ‚îÄ Most Read items ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.mr-item{display:flex;align-items:flex-start;gap:14px;background:var(--surface);padding:16px;cursor:pointer;transition:background .15s}
.mr-item:hover{background:var(--card-bg,var(--surface))}
.mr-rank{font-family:'Playfair Display',serif;font-size:26px;font-weight:800;color:var(--divider);line-height:1;flex-shrink:0;width:28px;text-align:right}
.mr-body{flex:1;min-width:0}
.mr-tag{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:.12em;text-transform:uppercase;color:var(--green,#2E9B5E);margin-bottom:5px}
.mr-headline{font-family:'Playfair Display',serif;font-size:14px;line-height:1.35;color:var(--text);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.mr-date{font-family:'DM Mono',monospace;font-size:10px;color:var(--text-soft);margin-top:5px}
</style>
</head>
<body>

<div class="toast" id="toast" role="status" aria-live="polite" aria-atomic="true"></div>

<!-- ‚ïê‚ïê‚ïê ADMIN PANEL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- ‚îÄ‚îÄ Admin Login Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div id="amiLoginModal" style="display:none;position:fixed;inset:0;z-index:9999;background:rgba(6,15,9,.85);backdrop-filter:blur(4px);align-items:center;justify-content:center">
  <div style="background:#0A1A10;border:1px solid #1A3020;border-top:2px solid #C9A84C;border-radius:4px;padding:36px 40px;width:100%;max-width:360px;box-shadow:0 20px 60px rgba(0,0,0,.6)">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:28px">
      <span style="font-family:'Playfair Display',serif;font-size:18px;color:#EDE5D5;letter-spacing:.02em">AMI Admin</span>
      <button onclick="amiLoginClose()" style="background:none;border:none;color:#6B8C72;font-size:20px;cursor:pointer;line-height:1;padding:0">‚úï</button>
    </div>
    <form id="amiLoginForm" onsubmit="supabaseLogin(event)">
      <div style="margin-bottom:16px">
        <label style="display:block;font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.12em;text-transform:uppercase;color:#6B8C72;margin-bottom:6px">Email</label>
        <input id="amiLoginEmail" type="email" required autocomplete="email"
          style="width:100%;background:#060F09;border:1px solid #1A3020;color:#EDE5D5;padding:10px 12px;border-radius:2px;font-family:'Spectral',serif;font-size:14px;outline:none;box-sizing:border-box"
          onfocus="this.style.borderColor='#C9A84C'" onblur="this.style.borderColor='#1A3020'">
      </div>
      <div style="margin-bottom:24px">
        <label style="display:block;font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.12em;text-transform:uppercase;color:#6B8C72;margin-bottom:6px">Password</label>
        <input id="amiLoginPassword" type="password" required autocomplete="current-password"
          style="width:100%;background:#060F09;border:1px solid #1A3020;color:#EDE5D5;padding:10px 12px;border-radius:2px;font-family:'Spectral',serif;font-size:14px;outline:none;box-sizing:border-box"
          onfocus="this.style.borderColor='#C9A84C'" onblur="this.style.borderColor='#1A3020'">
      </div>
      <p id="amiLoginError" style="color:#E57373;font-family:'DM Mono',monospace;font-size:11px;margin-bottom:16px;min-height:16px"></p>
      <button id="amiLoginBtn" type="submit"
        style="width:100%;background:#C9A84C;color:#060F09;border:none;padding:12px;font-family:'DM Mono',monospace;font-size:12px;letter-spacing:.1em;text-transform:uppercase;cursor:pointer;border-radius:2px;font-weight:600">
        Sign in
      </button>
    </form>
  </div>
</div>
<div class="admin-overlay" id="adminOverlay">
  <div class="admin-panel">
    <div class="admin-header">
      <div class="admin-logo">‚öô AMI Admin</div>
      <div id="dbStatus" class="admin-status loading">‚óè Connecting‚Ä¶</div>
      <button onclick="amiAdminLogout()" style="position:absolute;top:12px;right:16px;background:none;border:1px solid #1A3020;color:#6B8C72;font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.08em;padding:4px 10px;border-radius:2px;cursor:pointer" title="Sign out">Sign out</button>
      <button class="admin-close-btn" onclick="closeAdmin()" aria-label="Close admin panel">√ó</button>
    </div>
    <div class="admin-tabs">
      <div class="admin-tab active" onclick="switchTab(event,'articles')">Articles</div>
      <div class="admin-tab" onclick="switchTab(event,'markets')">Markets</div>
      <div class="admin-tab" onclick="switchTab(event,'breaking')">Breaking</div>
      <div class="admin-tab" onclick="switchTab(event,'settings')">Settings</div>
      <div class="admin-tab" onclick="switchTab(event,'subscribers')">Subscribers</div>
      <div class="admin-tab" onclick="switchTab(event,'pages')">Pages</div>
    </div>

    <!-- ARTICLES TAB -->
    <div class="admin-section active" id="tab-articles">
      <div class="admin-section-title">‚ûï Publish New Article</div>
      <details style="border:1px solid #1A3020;border-radius:2px;overflow:hidden;margin-bottom:20px">
        <summary style="padding:12px 14px;font-family:'DM Mono',monospace;font-size:11px;letter-spacing:.1em;text-transform:uppercase;color:#C9A84C;cursor:pointer;background:#0A1A10;list-style:none">Ôºã New Article Form</summary>
        <div style="padding:16px;background:#060F09">
          <div class="form-group"><label class="form-label" for="new-placement">Placement</label>
            <select class="form-select" id="new-placement">
              <option value="card">Article Card (Latest News)</option>
              <option value="hero">Hero ‚Äî Main Feature</option>
              <option value="side1">Side Story 1</option>
              <option value="side2">Side Story 2</option>
              <option value="archive">Archive Only (old news)</option>
            </select></div>
          <div class="form-group"><label class="form-label" for="new-section">Section / Region</label>
            <input class="form-input" id="new-section" placeholder="e.g. West Africa ¬∑ Politics"></div>
          <div class="form-group"><label class="form-label" for="new-headline">Headline</label>
            <textarea class="form-textarea" id="new-headline" style="min-height:65px" placeholder="Article headline..."></textarea></div>
          <div class="form-group"><label class="form-label" for="new-standfirst">Standfirst / Summary</label>
            <textarea class="form-textarea" id="new-standfirst" placeholder="2‚Äì3 sentence intro shown on homepage..."></textarea></div>
          <div class="form-group"><label class="form-label" for="new-body">Full Article Body (HTML supported)</label>
            <textarea class="form-textarea" id="new-body" style="min-height:160px;font-family:'DM Mono',monospace;font-size:11px" placeholder="Write the full article here...&#10;&#10;Use &lt;p&gt; for paragraphs, &lt;h2&gt; for headings, &lt;blockquote&gt; for quotes.&#10;Plain text also works ‚Äî paragraphs are auto-detected."></textarea></div>
          <!-- Hero Image Upload -->
          <div class="form-group"><label class="form-label" for="new-hero-url">Hero Image</label>
            <div class="img-upload-area" id="heroUploadArea">
              <input type="file" accept="image/*" id="new-hero-file" onchange="previewImage(this,'heroPreview','heroUploadArea')">
              <div class="img-upload-label">üì∑ Click or drag to upload hero image</div>
              <img id="heroPreview" class="img-preview">
            </div>
            <input class="form-input" id="new-hero-url" placeholder="Or paste image URL directly" style="font-size:11px;font-family:'DM Mono',monospace">
          </div>
          <div class="form-row">
            <div class="form-group" style="margin:0"><label class="form-label" for="new-author">Author Name</label>
              <input class="form-input" id="new-author" placeholder="Full name"></div>
            <div class="form-group" style="margin:0"><label class="form-label" for="new-author-role">Author Role</label>
              <input class="form-input" id="new-author-role" placeholder="e.g. West Africa Correspondent"></div>
          </div>
          <!-- Author Photo Upload -->
          <div class="form-group" style="margin-top:10px"><label class="form-label">Author Photo (optional)</label>
            <div class="img-upload-area" id="authorUploadArea">
              <input type="file" accept="image/*" id="new-author-file" onchange="previewImage(this,'authorPreview','authorUploadArea')">
              <div class="img-upload-label">üë§ Upload author photo</div>
              <img id="authorPreview" class="img-preview">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group" style="margin:0"><label class="form-label">Read Time</label>
              <input class="form-input" id="new-readtime" placeholder="5 min"></div>
            <div class="form-group" style="margin:0"><label class="form-label">Tags (comma-separated)</label>
              <input class="form-input" id="new-tags" placeholder="Nigeria, Markets, Policy"></div>
          </div>
          <label style="font-family:'DM Mono',monospace;font-size:10px;color:#888;display:flex;align-items:center;gap:6px;margin-top:12px">
            <input type="checkbox" id="new-locked"> üîí Premium ‚Äî locked behind paywall</label>
          <label style="font-family:'DM Mono',monospace;font-size:10px;color:#888;display:flex;align-items:center;gap:6px;margin-top:8px">
            <input type="checkbox" id="new-most-read"> üìå Add to Most Read</label>
          <button class="btn-save" id="publishBtn" onclick="publishArticle()" style="margin-top:14px">üì¢ Publish to Site ‚Üí</button>
        </div>
      </details>

      <div class="admin-section-title">üì∞ Live Articles</div>
      <div id="adminArticleList" style="font-family:'DM Mono',monospace;font-size:11px;color:#888">Loading articles‚Ä¶</div>
    </div>

    <!-- MARKETS TAB -->
    <div class="admin-section" id="tab-markets">
      <div class="admin-section-title">Update Market Data</div>
      <div class="market-edit-grid" id="marketEditGrid">
        <div style="color:#888;font-family:'DM Mono',monospace;font-size:11px">Loading‚Ä¶</div>
      </div>
      <button class="btn-save" onclick="saveMarkets()" style="margin-top:18px">üíæ Save All Markets ‚Üí</button>
    </div>

    <!-- BREAKING NEWS TAB -->
    <div class="admin-section" id="tab-breaking">
      <div class="admin-section-title">Breaking News Banner</div>
      <div class="form-group"><label class="form-label">Banner Text</label>
        <textarea class="form-textarea" id="breakingText" placeholder="Breaking news text..."></textarea></div>
      <div class="setting-row" style="border:none;padding:8px 0 16px">
        <div><div class="setting-label">Show Banner</div></div>
        <label class="toggle-switch"><input type="checkbox" id="showBreaking" checked><span class="toggle-slider"></span></label>
      </div>
      <button class="btn-save" onclick="saveBreaking()">üíæ Update Breaking News ‚Üí</button>
    </div>

    <!-- SETTINGS TAB -->
    <div class="admin-section" id="tab-settings">

      <!-- ‚îÄ‚îÄ Site Identity ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div class="admin-section-title">üèõ Site Identity</div>
      <div class="form-group"><label class="form-label">Publication Name</label>
        <input class="form-input" id="siteName" value="African Market Intelligence"></div>
      <div class="form-group"><label class="form-label">Tagline (below masthead)</label>
        <input class="form-input" id="siteTagline" value="The Continent's Premium Financial & Business Publication"></div>
      <div class="form-group"><label class="form-label">Edition Badge</label>
        <input class="form-input" id="editionLabel" value="Pan-African Edition"></div>
      <div class="form-group"><label class="form-label">Location Line</label>
        <input class="form-input" id="locationLine" value="Est. 2024 ¬∑ Nairobi ¬∑ Lagos ¬∑ Cairo ¬∑ Johannesburg"></div>

      <!-- ‚îÄ‚îÄ Newsletter Widget ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div class="admin-section-title" style="margin-top:22px">üìß Newsletter Widget</div>
      <div class="form-group"><label class="form-label">Widget Title</label>
        <input class="form-input" id="newsletterTitle" placeholder="AMI Morning Brief"></div>
      <div class="form-group"><label class="form-label">Widget Subtitle</label>
        <input class="form-input" id="newsletterSub" placeholder="Markets & deals delivered before 7am"></div>
      <div class="form-group"><label class="form-label">Button Label</label>
        <input class="form-input" id="newsletterBtn" placeholder="Subscribe Free ‚Üí"></div>
      <div class="form-group"><label class="form-label">Newsletter Sign-up URL (optional)</label>
        <input class="form-input" id="newsletterLink" placeholder="https://‚Ä¶ or leave blank"></div>

      <!-- ‚îÄ‚îÄ Subscription Plans ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div class="admin-section-title" style="margin-top:22px">üí≥ Subscription Plans</div>
      <div class="form-row">
        <div class="form-group" style="margin:0"><label class="form-label">Plan 1 Name</label>
          <input class="form-input" id="plan1Name" placeholder="Digital"></div>
        <div class="form-group" style="margin:0"><label class="form-label">Plan 1 Price</label>
          <input class="form-input" id="plan1Price" placeholder="$29"></div>
      </div>
      <div class="form-group" style="margin-top:8px"><label class="form-label">Plan 1 Stripe Link</label>
        <input class="form-input" id="plan1Link" placeholder="https://buy.stripe.com/‚Ä¶"></div>
      <div class="form-row" style="margin-top:8px">
        <div class="form-group" style="margin:0"><label class="form-label">Plan 2 Name</label>
          <input class="form-input" id="plan2Name" placeholder="Premium"></div>
        <div class="form-group" style="margin:0"><label class="form-label">Plan 2 Price</label>
          <input class="form-input" id="plan2Price" placeholder="$59"></div>
      </div>
      <div class="form-group" style="margin-top:8px"><label class="form-label">Plan 2 Stripe Link</label>
        <input class="form-input" id="plan2Link" placeholder="https://buy.stripe.com/‚Ä¶"></div>

      <!-- ‚îÄ‚îÄ Footer Content ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div class="admin-section-title" style="margin-top:22px">ü¶∂ Footer Content</div>
      <div class="form-group"><label class="form-label">Footer About Text</label>
        <textarea class="form-textarea" id="footerAboutText" placeholder="The continent's most trusted source‚Ä¶"></textarea></div>
      <div class="form-group"><label class="form-label">Copyright Line</label>
        <input class="form-input" id="copyrightText" placeholder="¬© 2025 African Market Intelligence Ltd."></div>

      <!-- ‚îÄ‚îÄ Footer Links Editor ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div class="admin-section-title" style="margin-top:22px">üîó Footer Navigation Links</div>
      <p style="font-size:11px;color:#888;font-family:'DM Mono',monospace;margin-bottom:16px;line-height:1.6">Edit every link that appears in the footer columns. Changes go live on all pages immediately after saving.</p>

      <!-- Column 1 -->
      <div style="background:#060F09;border:1px solid #1A3020;border-top:2px solid #C9A84C;padding:16px;margin-bottom:14px;border-radius:2px">
        <div style="font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.15em;text-transform:uppercase;color:#C9A84C;margin-bottom:10px">Column 1</div>
        <div class="form-group" style="margin-bottom:10px"><label class="form-label">Column Title</label>
          <input class="form-input" id="fc1Title" placeholder="Sections" value="Sections"></div>
        <div style="font-family:'DM Mono',monospace;font-size:9px;color:#555;letter-spacing:.1em;text-transform:uppercase;margin-bottom:6px">Links (Label ‚Üí URL)</div>
        <div id="fc1Editor"></div>
        <button onclick="addFooterLinkRow(1)" style="width:100%;margin-top:8px;background:transparent;border:1px dashed #1A3020;color:#888;font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.08em;text-transform:uppercase;padding:7px;cursor:pointer;border-radius:2px;transition:all .2s" onmouseover="this.style.borderColor='#C9A84C';this.style.color='#C9A84C'" onmouseout="this.style.borderColor='#1A3020';this.style.color='#888'">+ Add Link</button>
      </div>

      <!-- Column 2 -->
      <div style="background:#060F09;border:1px solid #1A3020;border-top:2px solid #B85C38;padding:16px;margin-bottom:14px;border-radius:2px">
        <div style="font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.15em;text-transform:uppercase;color:#B85C38;margin-bottom:10px">Column 2</div>
        <div class="form-group" style="margin-bottom:10px"><label class="form-label">Column Title</label>
          <input class="form-input" id="fc2Title" placeholder="Regions" value="Regions"></div>
        <div style="font-family:'DM Mono',monospace;font-size:9px;color:#555;letter-spacing:.1em;text-transform:uppercase;margin-bottom:6px">Links (Label ‚Üí URL)</div>
        <div id="fc2Editor"></div>
        <button onclick="addFooterLinkRow(2)" style="width:100%;margin-top:8px;background:transparent;border:1px dashed #1A3020;color:#888;font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.08em;text-transform:uppercase;padding:7px;cursor:pointer;border-radius:2px;transition:all .2s" onmouseover="this.style.borderColor='#C9A84C';this.style.color='#C9A84C'" onmouseout="this.style.borderColor='#1A3020';this.style.color='#888'">+ Add Link</button>
      </div>

      <!-- Column 3 -->
      <div style="background:#060F09;border:1px solid #1A3020;border-top:2px solid #2E9B5E;padding:16px;margin-bottom:20px;border-radius:2px">
        <div style="font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.15em;text-transform:uppercase;color:#2E9B5E;margin-bottom:10px">Column 3</div>
        <div class="form-group" style="margin-bottom:10px"><label class="form-label">Column Title</label>
          <input class="form-input" id="fc3Title" placeholder="Company" value="Company"></div>
        <div style="font-family:'DM Mono',monospace;font-size:9px;color:#555;letter-spacing:.1em;text-transform:uppercase;margin-bottom:6px">Links (Label ‚Üí URL)</div>
        <div id="fc3Editor"></div>
        <button onclick="addFooterLinkRow(3)" style="width:100%;margin-top:8px;background:transparent;border:1px dashed #1A3020;color:#888;font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.08em;text-transform:uppercase;padding:7px;cursor:pointer;border-radius:2px;transition:all .2s" onmouseover="this.style.borderColor='#C9A84C';this.style.color='#C9A84C'" onmouseout="this.style.borderColor='#1A3020';this.style.color='#888'">+ Add Link</button>
      </div>

      <!-- ‚îÄ‚îÄ Misc ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div class="setting-row">
        <div><div class="setting-label">Paywall Active</div><div class="setting-desc">Auto-show paywall after 30 seconds</div></div>
        <label class="toggle-switch"><input type="checkbox" id="paywallActive"><span class="toggle-slider"></span></label>
      </div>
      <div class="setting-row" style="border:none">
        <div><div class="setting-label">Dark Mode Default</div></div>
        <label class="toggle-switch"><input type="checkbox" id="darkDefault" onchange="toggleDark()"><span class="toggle-slider"></span></label>
      </div>

      <button class="btn-save" onclick="saveSettings()">üíæ Save All Settings ‚Üí</button>
    </div>
  </div>

  <!-- SUBSCRIBERS TAB -->
  <div class="admin-section" id="tab-subscribers">
    <div class="admin-section-title">Newsletter Subscribers</div>
    <div style="display:flex;gap:10px;margin-bottom:16px">
      <button class="btn-save" style="flex:1;margin:0" onclick="loadSubscribers()">Refresh List</button>
      <button class="btn-save" style="flex:1;margin:0;background:#1B3A6B" onclick="exportSubscribersCSV()">Export CSV</button>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:16px">
      <div style="background:#060F09;border:1px solid #1A3020;border-top:2px solid #C9A84C;padding:14px;text-align:center">
        <div id="subTotal" style="font-size:24px;font-weight:700;color:#EDE5D5;font-family:Georgia,serif">-</div>
        <div style="font-size:9px;color:#888;text-transform:uppercase;letter-spacing:.1em;margin-top:4px">Total</div>
      </div>
      <div style="background:#060F09;border:1px solid #1A3020;border-top:2px solid #2E9B5E;padding:14px;text-align:center">
        <div id="subThisWeek" style="font-size:24px;font-weight:700;color:#2E9B5E;font-family:Georgia,serif">-</div>
        <div style="font-size:9px;color:#888;text-transform:uppercase;letter-spacing:.1em;margin-top:4px">This Week</div>
      </div>
      <div style="background:#060F09;border:1px solid #1A3020;border-top:2px solid #B85C38;padding:14px;text-align:center">
        <div id="subThisMonth" style="font-size:24px;font-weight:700;color:#B85C38;font-family:Georgia,serif">-</div>
        <div style="font-size:9px;color:#888;text-transform:uppercase;letter-spacing:.1em;margin-top:4px">This Month</div>
      </div>
    </div>
    <div style="background:#060F09;border:1px solid #1A3020;overflow:hidden">
      <div style="display:grid;grid-template-columns:1fr 80px 100px;padding:8px 14px;border-bottom:1px solid #1A3020;font-size:9px;letter-spacing:.15em;text-transform:uppercase;color:#555">
        <span>Email</span><span>Source</span><span>Date</span>
      </div>
      <div id="subscriberList" style="max-height:380px;overflow-y:auto;font-size:11px">
        <div style="padding:24px;text-align:center;color:#555">Click Refresh to load subscribers</div>
      </div>
    </div>
  </div>

  <!-- Dashboard right panel -->
  <div class="admin-right">
    <div style="font-family:'Playfair Display',serif;font-size:22px;font-weight:700;color:#EDE5D5;margin-bottom:6px">Dashboard</div>
    <div style="font-family:'DM Mono',monospace;font-size:10px;color:#888;letter-spacing:.08em;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid #1A3020">AFRICAN MARKET INTELLIGENCE ¬∑ CONTENT MANAGEMENT</div>
    <div class="stat-grid">
      <div class="stat-card"><div class="stat-num" id="statArticles">‚Äî</div><div class="stat-label">Live Articles</div></div>
      <div class="stat-card"><div class="stat-num" id="statLocked">‚Äî</div><div class="stat-label">Premium Locked</div></div>
      <div class="stat-card"><div class="stat-num" id="statMarkets">8</div><div class="stat-label">Market Indices</div></div>
      <div class="stat-card"><div class="stat-num" id="statImages">‚Äî</div><div class="stat-label">Images Stored</div></div>
      <div class="stat-card" style="border-top-color:#C9A84C"><div class="stat-num" id="statSubscribers">‚Äî</div><div class="stat-label">Subscribers</div></div>
    </div>
    <div style="background:#060F09;border:1px solid #1A3020;padding:18px">
      <div style="font-family:'DM Mono',monospace;font-size:11px;color:#C9A84C;letter-spacing:.15em;text-transform:uppercase;margin-bottom:14px;padding-bottom:10px;border-bottom:1px solid #1A3020">Supabase Connection</div>
      <div style="font-size:13px;color:#A89070;line-height:1.8">
        <div>üì° URL: <span id="dbUrl" style="color:#EDE5D5;font-family:'DM Mono',monospace;font-size:10px">‚Äî</span></div>
        <div style="margin-top:8px;font-family:'DM Mono',monospace;font-size:10px;color:#555;line-height:1.8">
          To configure: open index.html<br>and paste your credentials at the top.
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê SITE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="breaking-banner" id="breakingBanner" role="alert" aria-live="assertive" style="display:none">
  <span class="breaking-label">Breaking</span>
  <span id="breakingTextDisplay" data-editable="text" data-cms-type="breaking" data-cms-key="breaking_text"></span>
  <button class="breaking-close" onclick="this.parentElement.style.display='none'" aria-label="Dismiss breaking news">√ó</button>
</div>

<div class="ticker-bar"><div class="ticker-inner" id="tickerInner">
  <span class="ticker-item"><span class="sym">Loading markets‚Ä¶</span></span>
</div></div>

<nav class="top-nav" aria-label="Main navigation">
  <button class="nav-hamburger" id="navHamburger" aria-expanded="false" aria-controls="navMobileDrawer" aria-label="Open navigation menu" onclick="toggleMobileNav()"><span></span><span></span><span></span></button><div class="nav-left">
    <a href="index.html"      class="nav-link" id="nav-home" aria-current="page" style="color:var(--gold);border-bottom:2px solid var(--gold)">Home</a>
    <a href="markets.html"    class="nav-link" id="nav-markets">Markets</a>
    <a href="politics.html"   class="nav-link" id="nav-politics">Politics</a>
    <a href="economy.html"    class="nav-link" id="nav-economy">Economy</a>
    <a href="energy.html"     class="nav-link" id="nav-energy">Energy</a>
    <a href="technology.html" class="nav-link" id="nav-technology">Tech</a>
    <a href="opinion.html"    class="nav-link" id="nav-opinion">Opinion</a>
    <a href="deals.html"    class="nav-link" id="nav-deals">Deals</a>
    <a href="archive.html"    class="nav-link" id="nav-archive">Archive</a>
  </div>
  <div class="nav-right">
    <label for="navSearchInput" class="sr-only">Search articles</label><input class="nav-search" type="search" id="navSearchInput" placeholder="Search AMI‚Ä¶" aria-label="Search articles" oninput="searchArticles(this.value)">
    <a href="about.html"      class="nav-link" id="nav-about">About</a>
    <a href="membership.html" class="nav-link" id="nav-membership">Membership</a>
    <a href="contact.html"    class="nav-link" id="nav-contact">Contact</a>
    <button class="dark-toggle" onclick="toggleDark()" id="themeBtn" aria-label="Toggle dark mode" title="Toggle dark mode">üåô</button>
    <a href="deals.html"     id="navSubscribeBtn" class="btn-subscribe">Deal Tracker</a>
  </div>
</nav>

<!-- ‚ïê‚ïê‚ïê MOBILE NAV DRAWER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="nav-mobile-drawer" id="navMobileDrawer"
     role="dialog" aria-modal="true"
     aria-label="Navigation menu" aria-hidden="true">
  <div class="nav-mobile-search">
    <input type="search" placeholder="Search AMI‚Ä¶" aria-label="Search articles"
           oninput="typeof searchArticles==='function'&&searchArticles(this.value)">
  </div>
  <a href="index.html">Home</a>
  <a href="markets.html">Markets</a>
  <a href="politics.html">Politics</a>
  <a href="economy.html">Economy</a>
  <a href="energy.html">Energy</a>
  <a href="technology.html">Technology</a>
  <a href="opinion.html">Opinion</a>
  <a href="deals.html">Deals</a>
  <a href="archive.html">Archive</a>
  <a href="about.html">About</a>
  <a href="membership.html">Membership</a>
  <a href="contact.html">Contact</a>
  <a href="membership.html" class="mob-subscribe">Subscribe ‚Üí</a>
</div>


<header class="masthead" role="banner">
  <div class="masthead-name" id="siteNameDisplay" data-editable="text" data-cms-type="setting" data-cms-key="site_name" onclick="handleLogoClick()" style="cursor:default" title="">African Market <span>Intelligence</span></div>
  <div class="masthead-tagline" id="siteTaglineDisplay" data-editable="text" data-cms-type="setting" data-cms-key="tagline">The Continent's Premium Financial & Business Publication</div>
  <div class="masthead-meta">
    <span id="mastDate"></span>
    <span class="edition-badge" id="editionDisplay" data-editable="text" data-cms-type="setting" data-cms-key="edition">Pan-African Edition</span>
    <span id="locationDisplay" data-editable="text" data-cms-type="setting" data-cms-key="location_line">Est. 2024 ¬∑ Nairobi ¬∑ Lagos ¬∑ Cairo ¬∑ Johannesburg</span>
  </div>
</header>

<div class="section-nav" role="navigation" aria-label="Filter by region"><div class="section-nav-inner">
  <span class="region-label">Region</span>
  <button type="button" class="section-tab active" onclick="filterSection(event,'all')">All Africa</button>
  <button type="button" class="section-tab" onclick="filterSection(event,'West Africa')">West Africa</button>
  <button type="button" class="section-tab" onclick="filterSection(event,'East Africa')">East Africa</button>
  <button type="button" class="section-tab" onclick="filterSection(event,'Southern Africa')">Southern Africa</button>
  <button type="button" class="section-tab" onclick="filterSection(event,'North Africa')">North Africa</button>
</div></div>

<div class="main-wrapper">
  <main id="main-content">
    <!-- Hero -->
    <div class="hero-grid" id="heroGrid">
      <!-- Skeleton loader -->
      <div class="hero-main" style="background:var(--card-bg)">
        <div class="hero-img-placeholder">Loading‚Ä¶</div>
        <div class="hero-content">
          <div class="skeleton skel-headline" style="width:90%;height:36px"></div>
          <div class="skeleton skel-text" style="margin-top:16px"></div>
          <div class="skeleton skel-text"></div>
          <div class="skeleton skel-text-short"></div>
        </div>
      </div>
      <div class="hero-side-1" style="background:var(--card-bg)">
        <div class="skeleton skel-headline"></div>
        <div class="skeleton skel-text"></div>
        <div class="skeleton skel-text-short"></div>
      </div>
      <div class="hero-side-2" style="background:var(--card-bg)">
        <div class="skeleton skel-headline"></div>
        <div class="skeleton skel-text"></div>
        <div class="skeleton skel-text-short"></div>
      </div>
    </div>

    <!-- Markets strip -->
    <div class="markets-strip">
      <div class="strip-title">African Markets at a Glance</div>
      <div class="markets-grid" id="marketsDisplay">
        <div class="skeleton" style="height:60px;border-radius:4px"></div>
        <div class="skeleton" style="height:60px;border-radius:4px"></div>
        <div class="skeleton" style="height:60px;border-radius:4px"></div>
        <div class="skeleton" style="height:60px;border-radius:4px"></div>
      </div>
    </div>

    <div class="section-header">
      <h2 class="section-title">Latest News</h2><div class="section-line"></div>
      <a href="#" class="view-more" id="viewAllLink">View all ‚Üí</a>
    </div>
    <div class="archive-header" id="archiveHeader" style="display:none">
      <span class="archive-title" id="archiveTitle">All Articles</span>
      <span class="archive-count" id="archiveCount"></span>
    </div>
    <div id="articleCardsContainer">
      <div class="article-row">
        <div class="article-card"><div class="card-img-placeholder">‚è≥</div><div class="card-content"><div class="skeleton skel-headline"></div><div class="skeleton skel-text"></div></div></div>
        <div class="article-card"><div class="card-img-placeholder">‚è≥</div><div class="card-content"><div class="skeleton skel-headline"></div><div class="skeleton skel-text"></div></div></div>
        <div class="article-card"><div class="card-img-placeholder">‚è≥</div><div class="card-content"><div class="skeleton skel-headline"></div><div class="skeleton skel-text"></div></div></div>
      </div>
    </div>

    <!-- Most Read -->
    <div id="paginationBar" class="pagination-bar"></div>
    <div class="section-header" style="margin-top:32px">
      <h2 class="section-title">Most Read</h2><div class="section-line"></div>
    </div>
    <div id="mostReadContainer" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:1px;background:var(--divider);border:1px solid var(--divider);margin-bottom:32px"></div>
  </main>

  <aside>
    <div class="newsletter-widget">
      <div class="nw-title" id="nwTitleDisplay" data-editable="text" data-cms-type="setting" data-cms-key="newsletter_title">AMI Morning Brief</div>
      <div class="nw-sub" id="nwSubDisplay" data-editable="text" data-cms-type="setting" data-cms-key="newsletter_sub">Markets & deals delivered before 7am across Africa.</div>
      <label for="nwEmailInput" class="sr-only">Email address</label><input class="nw-input" type="email" id="nwEmailInput" placeholder="your@email.com" aria-label="Your email address" autocomplete="email">
      <button class="nw-btn" id="nwBtnDisplay" onclick="handleNewsletterSignup()">Subscribe Free ‚Üí</button>
    </div>
    <div class="sidebar-widget">
      <div class="widget-title">Top Stories</div>
      <div id="topStoriesList"></div>
    </div>
    <div class="sidebar-widget">
      <div class="widget-title">Key Economic Data</div>
      <div class="data-row"><span class="data-label">Nigeria Inflation</span><span class="data-value dn">31.70%</span></div>
      <div class="data-row"><span class="data-label">SA Unemployment</span><span class="data-value dn">32.1%</span></div>
      <div class="data-row"><span class="data-label">Kenya GDP Growth</span><span class="data-value up">5.4%</span></div>
      <div class="data-row"><span class="data-label">Egypt Inflation</span><span class="data-value dn">24.1%</span></div>
      <div class="data-row"><span class="data-label">Ghana Prime Rate</span><span class="data-value">29.0%</span></div>
    </div>
  </aside>
</div>

<footer>
  <div class="footer-inner">
    <div class="footer-top">
      <div><div class="footer-brand" id="footerBrand" data-editable="text" data-cms-type="setting" data-cms-key="site_name">African Market Intelligence</div>
        <p class="footer-about" id="footerAboutDisplay" data-editable="text" data-cms-type="setting" data-cms-key="footer_about">The continent's most trusted source for financial news and business intelligence across Africa's 54 markets.</p></div>
      <div>
        <div class="footer-col-title" id="footerCol1Title" data-editable="text" data-cms-type="setting" data-cms-key="footer_col1_title">Sections</div>
        <ul class="footer-links" id="footerCol1Links">
          <li><a href="markets.html">Markets</a></li>
          <li><a href="economy.html">Economy</a></li>
          <li><a href="politics.html">Politics</a></li>
          <li><a href="energy.html">Energy</a></li>
          <li><a href="technology.html">Technology</a></li>
          <li><a href="opinion.html">Opinion</a></li>
        </ul>
      </div>
      <div>
        <div class="footer-col-title" id="footerCol2Title" data-editable="text" data-cms-type="setting" data-cms-key="footer_col2_title">Regions</div>
        <ul class="footer-links" id="footerCol2Links">
          <li><a href="west-africa.html">West Africa</a></li>
          <li><a href="east-africa.html">East Africa</a></li>
          <li><a href="north-africa.html">North Africa</a></li>
          <li><a href="southern-africa.html">Southern Africa</a></li>
        </ul>
      </div>
      <div>
        <div class="footer-col-title" id="footerCol3Title" data-editable="text" data-cms-type="setting" data-cms-key="footer_col3_title">Company</div>
        <ul class="footer-links" id="footerCol3Links">
          <li><a href="about.html">About AMI</a></li>
          <li><a href="membership.html">Membership</a></li>
          <li><a href="careers.html">Careers</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li><a href="privacy.html">Privacy Policy</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <span id="copyrightDisplay" data-editable="text" data-cms-type="setting" data-cms-key="copyright">¬© 2025 African Market Intelligence Ltd. All rights reserved.</span>
      <span>Terms ¬∑ Privacy ¬∑ Cookie Policy</span>
    </div>
  </div>
</footer>

<!-- Paywall -->
<div class="paywall-blur" id="paywallBlur"></div>
<div class="paywall-overlay" id="paywallOverlay">
  <div class="paywall-box">
    <div class="paywall-logo">African Market <span>Intelligence</span></div>
    <h2 class="paywall-headline">Subscribe to read this article</h2>
    <p class="paywall-sub">Join 48,000+ investors and executives across Africa who rely on AMI for premium financial intelligence.</p>
    <div class="paywall-plans">
      <div class="plan-card"><div class="plan-name">Digital</div><div class="plan-price">$29</div><div class="plan-period">/ month</div>
        <ul class="plan-features"><li>Unlimited articles</li><li>Morning Brief</li><li>Market data</li><li>AI summaries</li></ul></div>
      <div class="plan-card featured"><div class="plan-badge">Most Popular</div><div class="plan-name">Premium</div><div class="plan-price">$59</div><div class="plan-period">/ month</div>
        <ul class="plan-features"><li>Everything in Digital</li><li>Research reports</li><li>Events & webinars</li><li>Data downloads</li></ul></div>
    </div>
    <div class="paywall-cta">
      <a id="stripeDigital" href="#" target="_blank" class="btn-stripe">Digital ‚Äî $29/mo ‚Üí</a>
      <a id="stripePremium" href="#" target="_blank" class="btn-stripe-alt">Premium ‚Äî $59/mo ‚Üí</a>
    </div>
    <div style="margin-bottom:14px;text-align:center;font-family:'DM Mono',monospace;font-size:10px;color:var(--text-soft)">üîí Secure checkout powered by Stripe ¬∑ Cancel anytime</div>
    <button class="paywall-dismiss" onclick="closePaywall()">Continue with limited access</button>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SUPABASE CLIENT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const db = {
  async query(table, options={}) {
    const params = new URLSearchParams();
    if(options.select)  params.set('select', options.select);
    if(options.eq)      Object.entries(options.eq).forEach(([k,v])=>params.set(k,'eq.'+v));
    if(options.order)   params.set('order', options.order);
    if(options.limit)   params.set('limit', options.limit);
    const url = `${SUPABASE_URL}/rest/v1/${table}?${params}`;
    const r = await fetch(url, { headers: { apikey: SUPABASE_ANON, Authorization: 'Bearer '+SUPABASE_ANON } });
    if(!r.ok) throw new Error(await r.text());
    return r.json();
  },
  async insert(table, data) {
    const r = await fetch(`${SUPABASE_URL}/rest/v1/${table}`, {
      method:'POST',
      headers:{ apikey:SUPABASE_ANON, Authorization:'Bearer '+(AUTH_TOKEN||SUPABASE_ANON), 'Content-Type':'application/json', Prefer:'return=representation' },
      body: JSON.stringify(data)
    });
    if(!r.ok) throw new Error(await r.text());
    return r.json();
  },
  async update(table, data, match) {
    const params = new URLSearchParams();
    Object.entries(match).forEach(([k,v])=>params.set(k,'eq.'+v));
    const r = await fetch(`${SUPABASE_URL}/rest/v1/${table}?${params}`, {
      method:'PATCH',
      headers:{ apikey:SUPABASE_ANON, Authorization:'Bearer '+(AUTH_TOKEN||SUPABASE_ANON), 'Content-Type':'application/json', Prefer:'return=representation' },
      body: JSON.stringify(data)
    });
    if(!r.ok) throw new Error(await r.text());
    return r.json();
  },
  async delete(table, match) {
    const params = new URLSearchParams();
    Object.entries(match).forEach(([k,v])=>params.set(k,'eq.'+v));
    const r = await fetch(`${SUPABASE_URL}/rest/v1/${table}?${params}`, {
      method:'DELETE',
      headers:{ apikey:SUPABASE_ANON, Authorization:'Bearer '+(AUTH_TOKEN||SUPABASE_ANON) }
    });
    if(!r.ok) throw new Error(await r.text());
    return true;
  },
  async uploadImage(file, path) {
    const r = await fetch(`${SUPABASE_URL}/storage/v1/object/ami-images/${path}`, {
      method:'POST',
      headers:{ apikey:SUPABASE_ANON, Authorization:'Bearer '+(AUTH_TOKEN||SUPABASE_ANON), 'Content-Type': file.type },
      body: file
    });
    if(!r.ok) throw new Error(await r.text());
    return `${SUPABASE_URL}/storage/v1/object/public/ami-images/${path}`;
  }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let allArticles    = [];
let filteredCards  = []; // current filtered set for pagination
let allMarkets     = [];
let filterActive   = 'all';
let searchQuery    = '';
const ARTICLES_PER_PAGE = 9; // articles per page (3 rows of 3)
let currentPage    = 1;
let totalArticles  = 0;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById('mastDate').textContent =
  new Date().toLocaleDateString('en-GB',{weekday:'long',year:'numeric',month:'long',day:'numeric'});

// section tabs handled by filterSection()

// Stripe links
document.getElementById('stripeDigital').href = STRIPE_DIGITAL;
document.getElementById('stripePremium').href = STRIPE_PREMIUM;
document.getElementById('navSubscribeBtn').href = STRIPE_PREMIUM;

async function init() {
  if(!SUPABASE_URL || SUPABASE_URL === 'YOUR_SUPABASE_URL' || !SUPABASE_ANON || SUPABASE_ANON === 'YOUR_SUPABASE_ANON_KEY') {
    showConfigBanner(); return;
  }

  // Read page/section/q from URL
  const params = new URLSearchParams(window.location.search);
  currentPage  = parseInt(params.get('page')) || 1;
  if(params.get('section')) filterActive = params.get('section');
  if(params.get('q'))       searchQuery  = params.get('q');

  try {
    const [articles, markets, settings, breaking] = await Promise.all([
      db.query('articles', { select:'*', eq:{is_published:'true'}, order:'created_at.desc' }),
      db.query('markets',  { select:'*' }),
      db.query('site_settings', { select:'*' }),
      db.query('breaking_news', { select:'*', eq:{is_active:'true'}, limit:'1' })
    ]);
    allArticles = articles;
    allMarkets  = markets;
    applySettings(settings);
    renderBreaking(breaking);
    renderHero();
    renderMarketsStrip();
    renderTicker();
    renderCards();
    renderTopStories(); renderMostRead();
    // Activate correct section tab if section param set
    if(filterActive !== 'all') {
      document.querySelectorAll('.section-tab').forEach(t=>{
        if(t.textContent.includes(filterActive)) t.classList.add('active');
        else t.classList.remove('active');
      });
    }
  } catch(e) {
    console.error(e);
    showToast('‚ö† Could not connect to database. Check your Supabase credentials.','error');
  }
}

// Handle browser back/forward
window.addEventListener('popstate', e => {
  if(e.state){
    currentPage  = e.state.page || 1;
    filterActive = e.state.filterActive || 'all';
    searchQuery  = e.state.searchQuery || '';
    applyFilters();
  }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER FUNCTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function articleUrl(a) { return `article.html?id=${a.id}`; }

function heroImgHtml(a, height='220px') {
  if(a.hero_image) return `<img src="${a.hero_image}" class="hero-img" alt="${a.headline}" style="height:${height}" onerror="this.style.display='none'">`;
  return `<div class="hero-img-placeholder" style="height:${height}">üì∞ ${a.section||''}</div>`;
}

function renderHero() {
  const hero  = allArticles.find(a=>a.placement==='hero') || allArticles[0];
  const side1 = allArticles.find(a=>a.placement==='side1') || allArticles[1];
  const side2 = allArticles.find(a=>a.placement==='side2') || allArticles[2];
  if(!hero) return;

  document.getElementById('heroGrid').innerHTML = `
    <div class="hero-main" style="background:var(--card-bg)">
      ${heroImgHtml(hero,'200px')}
      <div class="hero-content">
        <div class="article-kicker">${hero.section||''}</div>
        <h1 class="hero-headline" tabindex="0" onclick="window.location.href='${articleUrl(hero)}'" onkeydown="if(event.key==='Enter')window.location.href='${articleUrl(hero)}'">${hero.headline}</h1>
        <p class="hero-standfirst">${hero.standfirst||''}</p>
        <div class="article-meta">
          
          <span>${hero.read_time||''}</span>
          ${hero.is_locked?'<span class="article-tag">Premium</span>':''}
        </div>
      </div>
    </div>
    ${side1?`<div class="hero-side-1" style="background:var(--card-bg)">
      ${side1.hero_image?`<img src="${side1.hero_image}" alt="${side1.headline}" style="width:100%;height:100px;object-fit:cover;display:block;margin-bottom:12px">`:''}
      <div class="article-section">${side1.section||''}</div>
      <h2 class="side-headline" tabindex="0" onclick="window.location.href='${articleUrl(side1)}'" onkeydown="if(event.key==='Enter')window.location.href='${articleUrl(side1)}'">${side1.headline}</h2>
      <p class="side-standfirst">${side1.standfirst||''}</p>
      <div class="article-meta" style="margin-top:12px"><span class="author">${side1.author_name||''}</span><span>${side1.read_time||''}</span>${side1.is_locked?'<span class="article-tag">Premium</span>':''}</div>
    </div>`:'<div class="hero-side-1" style="background:var(--card-bg)"></div>'}
    ${side2?`<div class="hero-side-2" style="background:var(--card-bg)">
      ${side2.hero_image?`<img src="${side2.hero_image}" alt="${side2.headline}" style="width:100%;height:90px;object-fit:cover;display:block;margin-bottom:12px">`:''}
      <div class="article-section">${side2.section||''}</div>
      <h2 class="side-headline" tabindex="0" onclick="window.location.href='${articleUrl(side2)}'" onkeydown="if(event.key==='Enter')window.location.href='${articleUrl(side2)}'">${side2.headline}</h2>
      <p class="side-standfirst">${side2.standfirst||''}</p>
      <div class="article-meta" style="margin-top:12px"><span class="author">${side2.author_name||''}</span><span>${side2.read_time||''}</span>${side2.is_locked?'<span class="article-tag">Premium</span>':''}</div>
    </div>`:'<div class="hero-side-2" style="background:var(--card-bg)"></div>'}`;
}

function renderCards(articles) {
  // Update filtered set
  filteredCards = (articles || allArticles).filter(a => window.ARCHIVE_MODE ? (a.placement !== 'hero' && a.placement !== 'side1' && a.placement !== 'side2') : a.placement === 'card');
  totalArticles = filteredCards.length;

  // Paginate
  const start = (currentPage - 1) * ARTICLES_PER_PAGE;
  const page  = filteredCards.slice(start, start + ARTICLES_PER_PAGE);

  const container = document.getElementById('articleCardsContainer');
  if(!filteredCards.length){
    container.innerHTML = '<p style="color:var(--text-soft);font-family:DM Mono,monospace;font-size:12px;padding:24px 0">No articles found.</p>';
    document.getElementById('paginationBar').innerHTML = '';
    document.getElementById('archiveHeader').style.display = 'none';
    return;
  }

  // Show archive header on page 2+
  const archiveHeader = document.getElementById('archiveHeader');
  const archiveCount  = document.getElementById('archiveCount');
  const section = filterActive !== 'all' ? filterActive : 'All Articles';
  document.getElementById('archiveTitle').textContent = searchQuery ? `Search: "${searchQuery}"` : section;
  archiveCount.textContent = `${totalArticles} article${totalArticles!==1?'s':''} ¬∑ Page ${currentPage} of ${Math.ceil(totalArticles/ARTICLES_PER_PAGE)}`;
  archiveHeader.style.display = 'flex';

  const rows = [];
  for(let i = 0; i < page.length; i += 3){
    const chunk = page.slice(i, i + 3);
    rows.push('<div class="article-row">' + chunk.map(a => `
      <div class="article-card" role="link" tabindex="0" onclick="window.location.href='${articleUrl(a)}'" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();window.location.href='${articleUrl(a)}'}">
        ${a.hero_image
          ? `<img src="${a.hero_image}" class="card-img" alt="${a.headline}" onerror="this.outerHTML='<div class=card-img-placeholder>üì∞</div>'">`
          : `<div class="card-img-placeholder">üì∞</div>`}
        <div class="card-content">
          <div class="article-kicker">${a.section||''}</div>
          <h3 class="card-headline">${a.is_locked?'üîí ':''} ${a.headline}</h3>
          <p class="card-body">${a.standfirst||''}</p>
          <div class="card-footer">
            <span>${a.read_time||'3 min'} ${a.is_locked?'<span class="lock-icon">üîí</span>':''}</span>
            <span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--text-soft)">${a.published_date||''}</span>
          </div>
        </div>
      </div>`).join('') + '</div>');
  }
  container.innerHTML = rows.join('');
  renderPagination();
}

function renderPagination() {
  const totalPages = Math.ceil(totalArticles / ARTICLES_PER_PAGE);
  const bar = document.getElementById('paginationBar');
  if(totalPages <= 1){ bar.innerHTML = ''; return; }

  const pages = buildPageNumbers(currentPage, totalPages);
  const section = filterActive !== 'all' ? `&section=${encodeURIComponent(filterActive)}` : '';
  const q = searchQuery ? `&q=${encodeURIComponent(searchQuery)}` : '';

  bar.innerHTML = `
    <a class="page-btn nav ${currentPage===1?'disabled':''}" onclick="goToPage(${currentPage-1})" href="?page=${currentPage-1}${section}${q}" aria-label="Previous page">‚Üê Prev</a>
    ${pages.map(p => p === '...'
      ? `<span class="page-ellipsis">‚Ä¶</span>`
      : `<a class="page-btn ${p===currentPage?'active':''}" onclick="goToPage(${p})" href="?page=${p}${section}${q}">${p}</a>`
    ).join('')}
    <a class="page-btn nav ${currentPage===totalPages?'disabled':''}" onclick="goToPage(${currentPage+1})" href="?page=${currentPage+1}${section}${q}" aria-label="Next page">Next ‚Üí</a>
  `;
}

function buildPageNumbers(current, total) {
  if(total <= 7) return Array.from({length:total}, (_,i)=>i+1);
  const pages = [];
  pages.push(1);
  if(current > 3) pages.push('...');
  for(let i = Math.max(2, current-1); i <= Math.min(total-1, current+1); i++) pages.push(i);
  if(current < total-2) pages.push('...');
  pages.push(total);
  return pages;
}

function goToPage(page) {
  event.preventDefault();
  const totalPages = Math.ceil(totalArticles / ARTICLES_PER_PAGE);
  if(page < 1 || page > totalPages) return;
  currentPage = page;
  // Update URL without page reload
  const section = filterActive !== 'all' ? `&section=${encodeURIComponent(filterActive)}` : '';
  const q = searchQuery ? `&q=${encodeURIComponent(searchQuery)}` : '';
  const newUrl = page === 1 ? window.location.pathname + (section||q ? '?'+section.slice(1)+(q?'&'+q.slice(1):'') : '') : `?page=${page}${section}${q}`;
  history.pushState({page, filterActive, searchQuery}, '', newUrl.replace('?&','?'));
  renderCards();
  // Scroll to top of article grid smoothly
  document.getElementById('archiveHeader')?.scrollIntoView({behavior:'smooth', block:'start'});
}

function renderMarketsStrip() {
  document.getElementById('marketsDisplay').innerHTML = allMarkets.map(m=>`
    <div class="market-item">
      <div class="market-name">${m.name}</div>
      <div class="market-value">${m.value}</div>
      <div class="market-change ${m.direction}">${m.direction==='up'?'‚ñ≤':'‚ñº'} ${m.change}</div>
    </div>`).join('');
}

function renderTicker() {
  const items = allMarkets.map(m=>`<span class="ticker-item"><span class="sym">${m.id.toUpperCase()}</span> ${m.value} <span class="${m.direction}">${m.direction==='up'?'‚ñ≤':'‚ñº'} ${m.change}</span></span>`).join('');
  document.getElementById('tickerInner').innerHTML = items + items; // duplicate for seamless loop
}

function renderTopStories() {
  const top = allArticles.slice(0,5);
  document.getElementById('topStoriesList').innerHTML = top.map((a,i)=>`
    <div class="top-story" role="link" tabindex="0" onclick="window.location.href='${articleUrl(a)}'" onkeydown="if(event.key==='Enter')window.location.href='${articleUrl(a)}'">
      <div class="top-story-num">0${i+1}</div>
      <div class="top-story-headline">${a.headline}</div>
    </div>`).join('');
}


function renderMostRead() {
  const el = document.getElementById('mostReadContainer');
  if (!el) return;
  // Pick up to 6 published articles ‚Äî skip hero/side placements already featured
  const pool = allArticles.filter(a => a.is_most_read).slice(0, 6);
  if (!pool.length) {
    el.style.display = 'none';
    const hdr = el.previousElementSibling;
    if (hdr && hdr.classList.contains('section-header')) hdr.style.display = 'none';
    return;
  }
  el.innerHTML = pool.map((a, i) => `
    <div class="mr-item" role="link" tabindex="0"
         onclick="window.location.href='${articleUrl ? articleUrl(a) : 'article.html?id='+a.id}'"
         onkeydown="if(event.key==='Enter')window.location.href='${articleUrl ? articleUrl(a) : 'article.html?id='+a.id}'">
      <div class="mr-rank">0${i + 1}</div>
      <div class="mr-body">
        <div class="mr-tag">${a.section || 'News'}</div>
        <div class="mr-headline">${a.headline}</div>
        <div class="mr-date">${a.published_date || ''}</div>
      </div>
    </div>`).join('');
}

function renderBreaking(breaking) {
  if(breaking && breaking.length>0 && breaking[0].is_active) {
    document.getElementById('breakingTextDisplay').textContent = breaking[0].text;
    document.getElementById('breakingBanner').style.display = 'flex';
  }
}

function applySettings(settings) {
  if(!settings) return;
  const get = key => (settings.find(s=>s.key===key)?.value) || '';
  const name = get('site_name') || 'African Market Intelligence';
  // Site identity
  document.getElementById('siteNameDisplay').innerHTML = name.replace(/(\S+)\s*$/, '<span>$1</span>');
  document.getElementById('siteTaglineDisplay').textContent = get('tagline');
  document.getElementById('editionDisplay').textContent     = get('edition');
  document.getElementById('footerBrand').textContent        = name;
  document.title = name;
  if(get('location_line') && document.getElementById('locationDisplay'))
    document.getElementById('locationDisplay').textContent = get('location_line');
  // Newsletter
  if(get('newsletter_title') && document.getElementById('nwTitleDisplay'))
    document.getElementById('nwTitleDisplay').textContent  = get('newsletter_title');
  if(get('newsletter_sub') && document.getElementById('nwSubDisplay'))
    document.getElementById('nwSubDisplay').textContent    = get('newsletter_sub');
  if(get('newsletter_btn') && document.getElementById('nwBtnDisplay'))
    document.getElementById('nwBtnDisplay').textContent    = get('newsletter_btn');
  // Footer
  if(get('footer_about') && document.getElementById('footerAboutDisplay'))
    document.getElementById('footerAboutDisplay').textContent = get('footer_about');
  if(get('copyright') && document.getElementById('copyrightDisplay'))
    document.getElementById('copyrightDisplay').textContent   = get('copyright');
  // Stripe
  const d1 = get('plan1_link'); const d2 = get('plan2_link');
  if(d1){ document.getElementById('stripeDigital').href = d1; }
  if(d2){ document.getElementById('stripePremium').href = d2; document.getElementById('navSubscribeBtn').href = d2; }
  // Footer columns ‚Äî titles + link lists
  renderFooterColumn('footerCol1Title','footerCol1Links',
    get('footer_col1_title')||'Sections', get('footer_col1_links'), 1);
  renderFooterColumn('footerCol2Title','footerCol2Links',
    get('footer_col2_title')||'Regions',  get('footer_col2_links'), 2);
  renderFooterColumn('footerCol3Title','footerCol3Links',
    get('footer_col3_title')||'Company',  get('footer_col3_links'), 3);
  // Populate admin footer link editors when admin panel is open
  if(document.getElementById('fc1Editor')) {
    if(document.getElementById('fc1Title')) document.getElementById('fc1Title').value = get('footer_col1_title')||'Sections';
    if(document.getElementById('fc2Title')) document.getElementById('fc2Title').value = get('footer_col2_title')||'Regions';
    if(document.getElementById('fc3Title')) document.getElementById('fc3Title').value = get('footer_col3_title')||'Company';
    populateFooterEditor(1, get('footer_col1_links'));
    populateFooterEditor(2, get('footer_col2_links'));
    populateFooterEditor(3, get('footer_col3_links'));
  }
  // Paywall
  if(get('paywall_active')==='true') setTimeout(showPaywall, 30000);
  // Populate admin form fields
  const fields = {
    siteName:get('site_name'), siteTagline:get('tagline'), editionLabel:get('edition'),
    locationLine:get('location_line'), newsletterTitle:get('newsletter_title'),
    newsletterSub:get('newsletter_sub'), newsletterBtn:get('newsletter_btn'),
    newsletterLink:get('newsletter_link'), plan1Name:get('plan1_name'),
    plan1Price:get('plan1_price'), plan1Link:get('plan1_link'), plan2Name:get('plan2_name'),
    plan2Price:get('plan2_price'), plan2Link:get('plan2_link'), aboutUrl:get('about_url'),
    careersUrl:get('careers_url'), privacyUrl:get('privacy_url'),
    footerAboutText:get('footer_about'), copyrightText:get('copyright')
  };
  Object.entries(fields).forEach(([id,val])=>{ const el=document.getElementById(id); if(el&&val) el.value=val; });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SEARCH & FILTER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function filterSection(e, section) {
  e.preventDefault();
  e.stopPropagation();
  document.querySelectorAll('.section-tab').forEach(x=>x.classList.remove('active'));
  e.target.classList.add('active');
  filterActive = section;
  currentPage  = 1;
  // Update URL
  const q = searchQuery ? `&q=${encodeURIComponent(searchQuery)}` : '';
  const newUrl = section === 'all' ? window.location.pathname : `?section=${encodeURIComponent(section)}${q}`;
  history.pushState({page:1, filterActive:section, searchQuery}, '', newUrl);
  applyFilters();
  // Scroll to articles
  document.getElementById('archiveHeader')?.scrollIntoView({behavior:'smooth', block:'start'});
}
function searchArticles(q) {
  searchQuery  = q.toLowerCase();
  currentPage  = 1;
  applyFilters();
}
function applyFilters(preservePage=false) {
  if(!preservePage) currentPage = 1; // reset to page 1 on new search/filter
  let filtered = allArticles;
  if(filterActive !== 'all') filtered = filtered.filter(a=>(a.section||'').includes(filterActive) || (a.tags||'').includes(filterActive));
  if(searchQuery) filtered = filtered.filter(a=>(a.headline||'').toLowerCase().includes(searchQuery)||(a.standfirst||'').toLowerCase().includes(searchQuery)||(a.author_name||'').toLowerCase().includes(searchQuery));
  renderCards(filtered.filter(a=>a.placement==='card'));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚îÄ‚îÄ Admin password gate ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let AUTH_TOKEN = null; // set on successful Supabase login
let logoClickCount = 0, logoClickTimer = null;

function handleLogoClick() {
  logoClickCount++;
  clearTimeout(logoClickTimer);
  logoClickTimer = setTimeout(()=>{ logoClickCount=0; }, 2000);
  if(logoClickCount >= 5) { logoClickCount=0; promptAdmin(); }
}

function promptAdmin() {
  // show login modal instead of password prompt
  document.getElementById('amiLoginModal').style.display = 'flex';
  setTimeout(() => {
    const el = document.getElementById('amiLoginEmail');
    if(el) el.focus();
  }, 80);
}

async function supabaseLogin(e) {
  e.preventDefault();
  const email    = document.getElementById('amiLoginEmail').value.trim();
  const password = document.getElementById('amiLoginPassword').value;
  const errEl    = document.getElementById('amiLoginError');
  const btn      = document.getElementById('amiLoginBtn');
  errEl.textContent = '';
  btn.textContent   = 'Signing in‚Ä¶';
  btn.disabled      = true;
  try {
    const r = await fetch(`${SUPABASE_URL}/auth/v1/token?grant_type=password`, {
      method: 'POST',
      headers: { apikey: SUPABASE_ANON, 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });
    const data = await r.json();
    if (!r.ok) throw new Error(data.error_description || data.msg || 'Login failed');
    AUTH_TOKEN = data.access_token;
    document.getElementById('amiLoginModal').style.display = 'none';
    document.getElementById('amiLoginForm').reset();
    openAdmin();
  } catch(err) {
    errEl.textContent = err.message;
  } finally {
    btn.textContent = 'Sign in';
    btn.disabled    = false;
  }
}

function amiLoginClose() {
  document.getElementById('amiLoginModal').style.display = 'none';
  document.getElementById('amiLoginForm').reset();
  document.getElementById('amiLoginError').textContent = '';
}

function toggleAdminVisibility(show) {
  // Optionally show a visible admin button when toggled on from within admin
  let btn = document.getElementById('visibleAdminBtn');
  if(show && !btn) {
    btn = document.createElement('button');
    btn.id = 'visibleAdminBtn';
    btn.className = 'admin-btn';
    btn.textContent = '‚öô Admin';
    btn.onclick = promptAdmin;
    document.querySelector('.nav-right').insertBefore(btn, document.querySelector('.btn-subscribe'));
  } else if(!show && btn) {
    btn.remove();
  }
}

async function handleNewsletterSignup() {
  const input = document.querySelector('.nw-input');
  const email = input?.value?.trim();
  if(!email){ showToast('Please enter your email address','error'); return; }
  // Basic email validation
  if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){
    showToast('Please enter a valid email address','error'); return;
  }
  const btn = document.getElementById('nwBtnDisplay');
  const origText = btn.textContent;
  btn.textContent = 'Subscribing‚Ä¶';
  btn.disabled = true;
  try {
    // Check if already subscribed
    const existing = await db.query('subscribers', { select:'id', eq:{email} });
    if(existing && existing.length > 0){
      showToast('‚úì You are already subscribed!');
      input.value = '';
    } else {
      await db.insert('subscribers', {
        email,
        source: 'homepage_widget',
        subscribed_at: new Date().toISOString()
      });
      showToast('‚úì Subscribed! Welcome to the AMI Morning Brief.');
      input.value = '';
      // Show thank you state
      const widget = input.closest('.newsletter-widget');
      if(widget){
        widget.innerHTML = `
          <div style="text-align:center;padding:12px 0">
            <div style="font-size:28px;margin-bottom:8px">üì¨</div>
            <div style="font-family:'Playfair Display',serif;font-size:18px;color:#C9A84C;margin-bottom:6px">You're in!</div>
            <div style="font-size:13px;color:#999;font-weight:300">Check your inbox tomorrow morning for your first briefing.</div>
          </div>`;
      }
    }
  } catch(e){
    showToast('‚úó Could not subscribe: '+e.message,'error');
  } finally {
    btn.disabled = false;
    btn.textContent = origText;
  }
}

// ‚îÄ‚îÄ Subscriber management (admin) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadSubscribers() {
  document.getElementById('subscriberList').innerHTML =
    '<div style="padding:24px;text-align:center;color:#888">Loading‚Ä¶</div>';
  try {
    const subs = await db.query('subscribers', { select:'*', order:'subscribed_at.desc' });
    const now  = new Date();
    const weekAgo  = new Date(now - 7*24*60*60*1000);
    const monthAgo = new Date(now.getFullYear(), now.getMonth(), 1);
    const thisWeek  = subs.filter(s=>new Date(s.subscribed_at)>=weekAgo).length;
    const thisMonth = subs.filter(s=>new Date(s.subscribed_at)>=monthAgo).length;
    document.getElementById('subTotal').textContent     = subs.length;
    document.getElementById('subThisWeek').textContent  = thisWeek;
    document.getElementById('subThisMonth').textContent = thisMonth;
    document.getElementById('statSubscribers').textContent = subs.length;
    if(!subs.length){
      document.getElementById('subscriberList').innerHTML =
        '<div style="padding:24px;text-align:center;color:#555">No subscribers yet.</div>';
      return;
    }
    document.getElementById('subscriberList').innerHTML = subs.map(s=>`
      <div style="display:grid;grid-template-columns:1fr auto auto;gap:12px;padding:10px 14px;border-bottom:1px solid #0A1A10;align-items:center">
        <span style="color:#EDE5D5;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${s.email}</span>
        <span style="color:#555;font-size:10px;letter-spacing:.05em">${s.source||'widget'}</span>
        <span style="color:#555;font-size:10px;white-space:nowrap">${new Date(s.subscribed_at).toLocaleDateString('en-GB',{day:'numeric',month:'short',year:'numeric'})}</span>
      </div>`).join('');
  } catch(e){
    document.getElementById('subscriberList').innerHTML =
      '<div style="padding:24px;color:#F44336;font-size:11px">Error: '+e.message+'</div>';
  }
}

function exportSubscribersCSV() {
  const rows = document.querySelectorAll('#subscriberList > div');
  if(!rows.length){ showToast('Load subscribers first','error'); return; }
  const lines = ['Email,Source,Date'];
  rows.forEach(row=>{
    const cells = row.querySelectorAll('span');
    if(cells.length>=3) lines.push([cells[0].textContent,cells[1].textContent,cells[2].textContent].join(','));
  });
  const blob = new Blob([lines.join('\n')], {type:'text/csv'});
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a'); a.href=url;
  a.download = 'ami-subscribers-'+new Date().toISOString().slice(0,10)+'.csv';
  a.click(); URL.revokeObjectURL(url);
  showToast('‚úì CSV downloaded');
}


function amiAdminLogout() {
  AUTH_TOKEN = null;
  document.getElementById('adminOverlay').classList.remove('open');
  showToast('Signed out');
}
async function openAdmin() {
  // Seed footer link editors with defaults if empty
  [1,2,3].forEach(col => {
    const container = document.getElementById('fc' + col + 'Editor');
    if(container && !container.children.length) populateFooterEditor(col, null);
  });
  document.getElementById('adminOverlay').classList.add('open');
  document.body.style.overflow='hidden';
  const st = document.getElementById('dbStatus');
  st.textContent='‚óè Connecting‚Ä¶'; st.className='admin-status loading';
  document.getElementById('dbUrl').textContent = SUPABASE_URL !== 'YOUR_SUPABASE_URL' ? SUPABASE_URL.split('//')[1] : 'Not configured';
  try {
    await loadAdminData();
    st.textContent='‚óè Connected'; st.className='admin-status connected';
  } catch(e) {
    st.textContent='‚óè Disconnected'; st.className='admin-status disconnected';
  }
}
function closeAdmin(){ document.getElementById('adminOverlay').classList.remove('open'); document.body.style.overflow=''; }
document.getElementById('adminOverlay').addEventListener('click',e=>{ if(e.target===document.getElementById('adminOverlay')) closeAdmin(); });
function switchTab(e,tab){
  document.querySelectorAll('.admin-tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.admin-section').forEach(s=>s.classList.remove('active'));
  e.target.classList.add('active');
  document.getElementById('tab-'+tab).classList.add('active');
  if(tab==='subscribers') loadSubscribers();
}

async function loadAdminData() {
  const [arts, mkts, brk] = await Promise.all([
    db.query('articles', { select:'*', order:'created_at.desc' }),
    db.query('markets',  { select:'*' }),
    db.query('breaking_news', { select:'*', order:'created_at.desc', limit:'1' })
  ]);
  allArticles = arts.filter(a=>a.is_published);
  allMarkets  = mkts;
  renderAdminArticleList(arts);
  renderMarketEditor(mkts);
  if(brk && brk[0]){
    document.getElementById('breakingText').value   = brk[0].text;
    document.getElementById('showBreaking').checked = brk[0].is_active;
  }
  document.getElementById('statArticles').textContent = arts.filter(a=>a.is_published).length;
  document.getElementById('statLocked').textContent   = arts.filter(a=>a.is_locked).length;
  document.getElementById('statImages').textContent   = arts.filter(a=>a.hero_image).length;
  // Load subscriber count
  try {
    const subs = await db.query('subscribers', { select:'id' });
    document.getElementById('statSubscribers').textContent = subs.length;
  } catch(e){}
}

function renderAdminArticleList(articles) {
  const el = document.getElementById('adminArticleList');
  if(!articles || !articles.length){ el.innerHTML='<div style="color:#555;padding:16px 0">No articles yet. Publish your first above.</div>'; return; }
  el.innerHTML = `<ul class="admin-article-list">${articles.map(a=>`
    <li class="admin-article-item">
      <div class="admin-article-header" onclick="toggleEdit(${a.id})">
        <div class="admin-article-info">
          <div class="admin-article-title">${a.headline}</div>
          <div class="admin-article-meta">
            <span class="badge badge-${a.placement}">${a.placement}</span>
            <span>${a.author_name||'‚Äî'}</span>
            <span>${a.published_date||''}</span>
            ${a.is_locked?'<span class="badge badge-locked">üîí</span>':''}
            ${!a.is_published?'<span class="badge" style="background:#555;color:#ccc">Draft</span>':''}
          </div>
        </div>
        <div style="display:flex;gap:6px">
          <button class="btn-danger" onclick="event.stopPropagation();deleteArticle(${a.id})">‚úï</button>
        </div>
      </div>
      <div class="admin-article-body" id="edit-${a.id}">
        <div class="form-group"><label class="form-label" for="new-headline">Headline</label><textarea class="form-textarea" id="eh-${a.id}" style="min-height:55px">${a.headline}</textarea></div>
        <div class="form-group"><label class="form-label">Standfirst</label><textarea class="form-textarea" id="es-${a.id}">${a.standfirst||''}</textarea></div>
        <div class="form-group"><label class="form-label">Full Article Body</label><textarea class="form-textarea" id="eb-${a.id}" style="min-height:120px;font-family:'DM Mono',monospace;font-size:11px">${(a.body||'').replace(/</g,'&lt;')}</textarea></div>
        <div class="form-group"><label class="form-label">Hero Image URL</label><input class="form-input" id="ei-${a.id}" value="${a.hero_image||''}"></div>
        <div class="form-group"><label class="form-label">Replace Image</label>
          <div class="img-upload-area"><input type="file" accept="image/*" onchange="uploadAndSetImage(this,${a.id})"><div class="img-upload-label">üì∑ Upload new image</div></div>
          ${a.hero_image?`<img src="${a.hero_image}" style="width:100%;height:80px;object-fit:cover;border-radius:2px;margin-top:6px">`:''}
        </div>
        <div class="form-row">
          <div class="form-group" style="margin:0"><label class="form-label">Section</label><input class="form-input" id="ec-${a.id}" value="${a.section||''}"></div>
          <div class="form-group" style="margin:0"><label class="form-label">Author</label><input class="form-input" id="ea-${a.id}" value="${a.author_name||''}"></div>
        </div>
        <div class="form-row" style="margin-top:10px">
          <div class="form-group" style="margin:0"><label class="form-label">Read Time</label><input class="form-input" id="er-${a.id}" value="${a.read_time||''}"></div>
          <div class="form-group" style="margin:0"><label class="form-label" for="new-placement">Placement</label>
            <select class="form-select" id="ep-${a.id}">
              <option value="card" ${a.placement==='card'?'selected':''}>Card</option>
              <option value="hero" ${a.placement==='hero'?'selected':''}>Hero</option>
              <option value="side1" ${a.placement==='side1'?'selected':''}>Side 1</option>
              <option value="side2" ${a.placement==='side2'?'selected':''}>Side 2</option>
            </select></div>
        </div>
        <div style="margin-top:12px;display:flex;gap:14px;align-items:center">
          <label style="font-family:'DM Mono',monospace;font-size:10px;color:#888;display:flex;align-items:center;gap:5px"><input type="checkbox" id="el-${a.id}" ${a.is_locked?'checked':''}> üîí Premium</label>
          <label style="font-family:'DM Mono',monospace;font-size:10px;color:#888;display:flex;align-items:center;gap:5px"><input type="checkbox" id="ep2-${a.id}" ${a.is_published?'checked':''}> ‚úÖ Published</label>
          <label style="font-family:'DM Mono',monospace;font-size:10px;color:#888;display:flex;align-items:center;gap:5px"><input type="checkbox" id="emr-${a.id}" ${a.is_most_read?'checked':''}> üìå Most Read</label>
        </div>
        <button class="btn-save" onclick="saveArticle(${a.id})" style="margin-top:12px">üíæ Save Changes ‚Üí</button>
      </div>
    </li>`).join('')}</ul>`;
}

function toggleEdit(id){ document.getElementById('edit-'+id).classList.toggle('open'); }

async function uploadAndSetImage(input, articleId) {
  const file = input.files[0]; if(!file) return;
  showToast('‚è≥ Uploading image‚Ä¶', 'loading');
  try {
    const path = `articles/${articleId}-${Date.now()}-${file.name}`;
    const url  = await db.uploadImage(file, path);
    document.getElementById('ei-'+articleId).value = url;
    showToast('‚úì Image uploaded ‚Äî save the article to apply');
  } catch(e) { showToast('‚úó Upload failed: '+e.message,'error'); }
}

async function deleteArticle(id) {
  if(!confirm('Delete this article permanently from the database?')) return;
  try {
    await db.delete('articles', {id});
    showToast('‚úì Article deleted');
    await loadAdminData();
    renderHero(); renderCards(); renderTopStories(); renderMostRead(); renderMostRead();
  } catch(e){ showToast('‚úó '+e.message,'error'); }
}

async function saveArticle(id) {
  const btn = event.target; btn.disabled=true; btn.textContent='Saving‚Ä¶';
  try {
    let bodyRaw = document.getElementById('eb-'+id).value;
    // Convert plain text to HTML paragraphs if needed
    if(!bodyRaw.trim().startsWith('<')) {
      bodyRaw = bodyRaw.split(/\n\n+/).filter(p=>p.trim()).map(p=>`<p>${p.trim()}</p>`).join('\n');
    }
    await db.update('articles', {
      headline:     document.getElementById('eh-'+id).value,
      standfirst:   document.getElementById('es-'+id).value,
      body:         bodyRaw,
      hero_image:   document.getElementById('ei-'+id).value,
      section:      document.getElementById('ec-'+id).value,
      author_name:  document.getElementById('ea-'+id).value,
      read_time:    document.getElementById('er-'+id).value,
      placement:    document.getElementById('ep-'+id).value,
      is_locked:     document.getElementById('el-'+id).checked,
      is_most_read:  document.getElementById('emr-'+id) ? document.getElementById('emr-'+id).checked : false,
      is_published: document.getElementById('ep2-'+id).checked,
      updated_at:   new Date().toISOString()
    }, {id});
    showToast('‚úì Saved to database ‚Äî live on site now');
    await loadAdminData();
    renderHero(); renderCards(); renderTopStories(); renderMostRead(); renderMostRead();
  } catch(e){ showToast('‚úó '+e.message,'error'); }
  finally{ btn.disabled=false; btn.textContent='üíæ Save Changes ‚Üí'; }
}

// Image preview helper
function previewImage(input, previewId, areaId) {
  const file = input.files[0]; if(!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    const img = document.getElementById(previewId);
    img.src = e.target.result; img.style.display='block';
  };
  reader.readAsDataURL(file);
}

async function publishArticle() {
  const btn = document.getElementById('publishBtn');
  const headline = document.getElementById('new-headline').value.trim();
  if(!headline){ showToast('Please enter a headline','error'); return; }
  btn.disabled=true; btn.textContent='Publishing‚Ä¶';
  try {
    // Handle image upload first
    let heroImageUrl = document.getElementById('new-hero-url').value.trim();
    const heroFile   = document.getElementById('new-hero-file').files[0];
    let authorPhotoUrl = '';
    const authorFile = document.getElementById('new-author-file').files[0];

    if(heroFile) {
      showToast('‚è≥ Uploading hero image‚Ä¶','loading');
      heroImageUrl = await db.uploadImage(heroFile, `articles/hero-${Date.now()}-${heroFile.name}`);
    }
    if(authorFile) {
      authorPhotoUrl = await db.uploadImage(authorFile, `authors/${Date.now()}-${authorFile.name}`);
    }

    let bodyRaw = document.getElementById('new-body').value;
    if(bodyRaw.trim() && !bodyRaw.trim().startsWith('<')) {
      bodyRaw = bodyRaw.split(/\n\n+/).filter(p=>p.trim()).map(p=>`<p>${p.trim()}</p>`).join('\n');
    }

    const authorName = document.getElementById('new-author').value;
    await db.insert('articles', {
      headline:        headline,
      standfirst:      document.getElementById('new-standfirst').value,
      body:            bodyRaw,
      section:         document.getElementById('new-section').value || 'News',
      author_name:     authorName,
      author_role:     document.getElementById('new-author-role').value,
      author_initials: authorName.split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,2),
      author_photo:    authorPhotoUrl,
      hero_image:      heroImageUrl,
      read_time:       document.getElementById('new-readtime').value || '3 min',
      published_date:  new Date().toLocaleDateString('en-GB',{day:'numeric',month:'short',year:'numeric'}),
      placement:       document.getElementById('new-placement').value,
      is_locked:       document.getElementById('new-locked').checked,
      is_most_read:    document.getElementById('new-most-read') ? document.getElementById('new-most-read').checked : false,
      is_published:    true,
      tags:            document.getElementById('new-tags').value,
    });

    // Clear form
    ['new-headline','new-standfirst','new-body','new-author','new-author-role','new-readtime','new-section','new-tags','new-hero-url'].forEach(id=>{
      const el=document.getElementById(id); if(el) el.value='';
    });
    document.getElementById('new-locked').checked=false;
    if(document.getElementById('new-most-read')) document.getElementById('new-most-read').checked=false;
    document.getElementById('heroPreview').style.display='none';
    document.getElementById('authorPreview').style.display='none';

    showToast('‚úì Article published to database ‚Äî live on site!');
    await loadAdminData();
    renderHero(); renderCards(); renderTopStories(); renderMostRead(); renderMostRead();
  } catch(e){ showToast('‚úó '+e.message,'error'); }
  finally{ btn.disabled=false; btn.textContent='üì¢ Publish to Site ‚Üí'; }
}

function renderMarketEditor(markets) {
  document.getElementById('marketEditGrid').innerHTML=(markets||allMarkets).map(m=>`
    <div class="market-edit-item">
      <div class="market-edit-name">${m.name}</div>
      <input class="mini-input" id="mv-${m.id}" value="${m.value}" placeholder="Value">
      <input class="mini-input" id="mc-${m.id}" value="${m.change}" placeholder="e.g. +1.24%">
      <div class="dir-toggle">
        <div class="dir-btn up ${m.direction==='up'?'active':''}" onclick="setDir('${m.id}','up',this)">‚ñ≤ Up</div>
        <div class="dir-btn dn ${m.direction==='dn'?'active':''}" onclick="setDir('${m.id}','dn',this)">‚ñº Down</div>
      </div>
    </div>`).join('');
}

function setDir(id,dir,el){
  el.closest('.dir-toggle').querySelectorAll('.dir-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
}

async function saveMarkets() {
  try {
    await Promise.all(allMarkets.map(m => {
      const v = document.getElementById('mv-'+m.id)?.value;
      const c = document.getElementById('mc-'+m.id)?.value;
      const p = document.getElementById('mv-'+m.id)?.closest('.market-edit-item');
      const activeDir = p?.querySelector('.dir-btn.active');
      const dir = activeDir?.classList.contains('up') ? 'up' : 'dn';
      return db.update('markets', { value:v||m.value, change:c||m.change, direction:dir, updated_at:new Date().toISOString() }, {id:m.id});
    }));
    const updated = await db.query('markets',{select:'*'});
    allMarkets = updated;
    renderMarketsStrip(); renderTicker();
    showToast('‚úì Market data saved to database');
  } catch(e){ showToast('‚úó '+e.message,'error'); }
}

async function saveBreaking() {
  try {
    const text   = document.getElementById('breakingText').value;
    const active = document.getElementById('showBreaking').checked;
    // Deactivate all, then insert new
    const existing = await db.query('breaking_news',{select:'id',limit:'1'});
    if(existing && existing[0]) {
      await db.update('breaking_news', {text, is_active:active}, {id:existing[0].id});
    } else {
      await db.insert('breaking_news', {text, is_active:active});
    }
    document.getElementById('breakingTextDisplay').textContent = text;
    document.getElementById('breakingBanner').style.display = active ? 'flex' : 'none';
    showToast('‚úì Breaking news saved');
  } catch(e){ showToast('‚úó '+e.message,'error'); }
}

async function saveSettings() {
  try {
    const settings = [
      { key:'site_name',        value:document.getElementById('siteName')?.value||'' },
      { key:'tagline',          value:document.getElementById('siteTagline')?.value||'' },
      { key:'edition',          value:document.getElementById('editionLabel')?.value||'' },
      { key:'location_line',    value:document.getElementById('locationLine')?.value||'' },
      { key:'paywall_active',   value:String(document.getElementById('paywallActive')?.checked||false) },
      { key:'newsletter_title', value:document.getElementById('newsletterTitle')?.value||'' },
      { key:'newsletter_sub',   value:document.getElementById('newsletterSub')?.value||'' },
      { key:'newsletter_btn',   value:document.getElementById('newsletterBtn')?.value||'' },
      { key:'newsletter_link',  value:document.getElementById('newsletterLink')?.value||'' },
      { key:'plan1_name',       value:document.getElementById('plan1Name')?.value||'' },
      { key:'plan1_price',      value:document.getElementById('plan1Price')?.value||'' },
      { key:'plan1_link',       value:document.getElementById('plan1Link')?.value||'' },
      { key:'plan2_name',       value:document.getElementById('plan2Name')?.value||'' },
      { key:'plan2_price',      value:document.getElementById('plan2Price')?.value||'' },
      { key:'plan2_link',       value:document.getElementById('plan2Link')?.value||'' },
      { key:'footer_about',     value:document.getElementById('footerAboutText')?.value||'' },
      { key:'copyright',        value:document.getElementById('copyrightText')?.value||'' },
      { key:'footer_col1_title',value:document.getElementById('fc1Title')?.value||'Sections' },
      { key:'footer_col2_title',value:document.getElementById('fc2Title')?.value||'Regions' },
      { key:'footer_col3_title',value:document.getElementById('fc3Title')?.value||'Company' },
      { key:'footer_col1_links',value:getFooterLinksJSON(1) },
      { key:'footer_col2_links',value:getFooterLinksJSON(2) },
      { key:'footer_col3_links',value:getFooterLinksJSON(3) },
    ];
    await Promise.all(settings.map(s =>
      db.update('site_settings',{value:s.value},{key:s.key})
        .catch(()=>db.insert('site_settings',{key:s.key,value:s.value}))
    ));
    applySettings(settings.map(s=>({key:s.key,value:s.value})));
    showToast('‚úì All settings saved and live on site');
  } catch(e){ showToast('‚úó '+e.message,'error'); }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UI HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleDark(){
  const h=document.documentElement,dark=h.getAttribute('data-theme')==='dark';
  h.setAttribute('data-theme',dark?'light':'dark');
  document.getElementById('themeBtn').textContent=dark?'üåô':'‚òÄÔ∏è';
}

function toggleMobileNav(){
  var drawer=document.getElementById("navMobileDrawer");
  var btn=document.getElementById("navHamburger");
  var isOpen=drawer.classList.contains("open");
  drawer.classList.toggle("open",!isOpen);
  btn.setAttribute("aria-expanded",String(!isOpen));
  btn.setAttribute("aria-label",isOpen?"Open navigation menu":"Close navigation menu");
  document.body.style.overflow=isOpen?"":"hidden";
}
document.addEventListener("DOMContentLoaded",function(){
  document.querySelectorAll("#navMobileDrawer a").forEach(function(el){
    el.addEventListener("click",function(){
      var drawer=document.getElementById("navMobileDrawer");
      var btn=document.getElementById("navHamburger");
      drawer.classList.remove("open");
      btn.setAttribute("aria-expanded","false");
      btn.setAttribute("aria-label","Open navigation menu");
      document.body.style.overflow="";
    });
  });
});


function showPaywall(){ document.getElementById('paywallOverlay').style.display='flex'; document.getElementById('paywallBlur').style.display='block'; }
function closePaywall(){ document.getElementById('paywallOverlay').style.display='none'; document.getElementById('paywallBlur').style.display='none'; }

function showToast(msg, type='success'){
  const t=document.getElementById('toast'); t.textContent=msg;
  if(type==='error'){ t.style.background='#4D1B1B'; t.style.borderColor='#F44336'; t.style.color='#F44336'; }
  else if(type==='loading'){ t.style.background='#0D1F12'; t.style.borderColor='#C9A84C'; t.style.color='#C9A84C'; }
  else { t.style.background='#0D3B1C'; t.style.borderColor='#2E9B5E'; t.style.color='#2E9B5E'; }
  t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),4000);
}

function showConfigBanner(){
  document.getElementById('heroGrid').innerHTML=`
    <div style="grid-column:1/-1;background:var(--card-bg);padding:48px;text-align:center;border:2px dashed var(--gold)">
      <div style="font-family:'Playfair Display',serif;font-size:28px;font-weight:700;margin-bottom:12px;color:var(--gold)">‚öô Configure Supabase</div>
      <p style="font-size:15px;color:var(--text-soft);max-width:500px;margin:0 auto 20px;line-height:1.7">Open <code style="background:var(--divider);padding:2px 8px;border-radius:2px">config.js</code> and replace <code style="background:var(--divider);padding:2px 8px;border-radius:2px">YOUR_SUPABASE_URL</code> and <code style="background:var(--divider);padding:2px 8px;border-radius:2px">YOUR_SUPABASE_ANON_KEY</code> with your credentials from Supabase ‚Üí Project Settings ‚Üí API.</p>
      <div style="font-family:'DM Mono',monospace;font-size:11px;color:var(--text-soft)">See the included <strong>supabase-setup.sql</strong> file for full setup instructions.</div>
    </div>`;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PAGES CMS ‚Äî load & save static page content via Supabase
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadPageContent(page) {
  const titleEl    = document.getElementById('page-title');
  const subtitleEl = document.getElementById('page-subtitle');
  const bodyEl     = document.getElementById('page-body');
  if(!titleEl||!subtitleEl||!bodyEl) return;
  try {
    const [t,s,b] = await Promise.all([
      db.query('site_settings',{select:'*',eq:{key:`page_${page}_title`}}),
      db.query('site_settings',{select:'*',eq:{key:`page_${page}_subtitle`}}),
      db.query('site_settings',{select:'*',eq:{key:`page_${page}_body`}}),
    ]);
    titleEl.value    = (t&&t[0]) ? t[0].value : '';
    subtitleEl.value = (s&&s[0]) ? s[0].value : '';
    bodyEl.value     = (b&&b[0]) ? b[0].value : '';
    showToast('‚úì Loaded ' + page + ' content from database');
  } catch(e) { showToast('‚úó ' + e.message, 'error'); }
}

async function savePage() {
  const page     = document.getElementById('pages-selector').value;
  const titleVal = document.getElementById('page-title').value;
  const subVal   = document.getElementById('page-subtitle').value;
  const bodyVal  = document.getElementById('page-body').value;
  const btn = document.querySelector('#tab-pages .btn-save');
  if(btn){ btn.disabled=true; btn.textContent='Saving‚Ä¶'; }
  try {
    const upsert = async (key, value) => {
      try { await db.update('site_settings',{value},{key}); }
      catch(e) {
        const rows = await db.query('site_settings',{select:'id',eq:{key}});
        if(rows&&rows.length) await db.update('site_settings',{value},{key});
        else await db.insert('site_settings',{key,value});
      }
    };
    await Promise.all([
      upsert(`page_${page}_title`,   titleVal),
      upsert(`page_${page}_subtitle`, subVal),
      upsert(`page_${page}_body`,    bodyVal),
    ]);
    showToast('‚úì ' + page + ' page saved ‚Äî live on site now!');
  } catch(e) { showToast('‚úó ' + e.message, 'error'); }
  finally { if(btn){ btn.disabled=false; btn.textContent='üíæ Save Page Content ‚Üí'; } }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FOOTER LINKS CMS EDITOR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const FOOTER_DEFAULTS = {
  1: [
    {label:'Markets',   href:'markets.html'},
    {label:'Economy',   href:'economy.html'},
    {label:'Politics',  href:'politics.html'},
    {label:'Energy',    href:'energy.html'},
    {label:'Technology',href:'technology.html'},
    {label:'Opinion',   href:'opinion.html'},
  ],
  2: [
    {label:'West Africa',    href:'west-africa.html'},
    {label:'East Africa',    href:'east-africa.html'},
    {label:'North Africa',   href:'north-africa.html'},
    {label:'Southern Africa',href:'southern-africa.html'},
  ],
  3: [
    {label:'About AMI',    href:'about.html'},
    {label:'Membership',   href:'membership.html'},
    {label:'Careers',      href:'careers.html'},
    {label:'Contact',      href:'contact.html'},
    {label:'Privacy Policy',href:'privacy.html'},
  ]
};

function addFooterLinkRow(col, label='', href='') {
  const container = document.getElementById('fc' + col + 'Editor');
  if(!container) return;
  const row = document.createElement('div');
  row.className = 'fc-link-row';
  row.style.cssText = 'display:grid;grid-template-columns:1fr 1fr 26px;gap:5px;margin-bottom:5px;align-items:center';
  row.innerHTML =
    '<input class="mini-input" placeholder="Label" value="' + label.replace(/"/g,'&quot;') + '" style="font-size:11px">' +
    '<input class="mini-input" placeholder="URL" value="' + href.replace(/"/g,'&quot;') + '" style="font-size:11px">' +
    '<button onclick="this.parentElement.remove()" style="background:#4D1B1B;border:1px solid #F44336;color:#F44336;border-radius:2px;cursor:pointer;font-size:14px;line-height:1;width:26px;height:26px;display:flex;align-items:center;justify-content:center;flex-shrink:0">√ó</button>';
  container.appendChild(row);
}

function getFooterLinksJSON(col) {
  const rows = document.querySelectorAll('#fc' + col + 'Editor .fc-link-row');
  const links = Array.from(rows).map(r => {
    const inputs = r.querySelectorAll('input');
    return { label: inputs[0].value.trim(), href: inputs[1].value.trim() };
  }).filter(l => l.label || l.href);
  return JSON.stringify(links);
}

function populateFooterEditor(col, linksJson) {
  const container = document.getElementById('fc' + col + 'Editor');
  if(!container) return;
  container.innerHTML = '';
  let links;
  try { links = linksJson ? JSON.parse(linksJson) : FOOTER_DEFAULTS[col]; }
  catch(e) { links = FOOTER_DEFAULTS[col]; }
  (links||FOOTER_DEFAULTS[col]).forEach(l => addFooterLinkRow(col, l.label, l.href));
}

function renderFooterColumn(titleId, listId, titleVal, linksJson, col) {
  const titleEl = document.getElementById(titleId);
  const listEl  = document.getElementById(listId);
  if(titleEl && titleVal) titleEl.textContent = titleVal;
  if(listEl) {
    try {
      const links = linksJson ? JSON.parse(linksJson) : FOOTER_DEFAULTS[col];
      listEl.innerHTML = (links||FOOTER_DEFAULTS[col])
        .map(l => '<li><a href="' + l.href + '">' + l.label + '</a></li>').join('');
    } catch(e) { /* keep defaults */ }
  }
}
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// START
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
filterActive = 'Southern Africa';
init();
</script>

<!-- ‚ïê‚ïê‚ïê INLINE EDITOR UI ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- Rich-text toolbar -->
<div class="ami-rte-bar" id="amiRteBar" role="toolbar" aria-label="Text formatting">
  <button class="ami-rte-btn" onclick="rteCmd('bold')" title="Bold" aria-label="Bold"><b>B</b></button>
  <button class="ami-rte-btn" onclick="rteCmd('italic')" title="Italic" aria-label="Italic"><i>I</i></button>
  <button class="ami-rte-btn" onclick="rteCmd('underline')" title="Underline" aria-label="Underline"><u>U</u></button>
  <div class="ami-rte-sep"></div>
  <button class="ami-rte-btn" onclick="rteCmd('formatBlock','h2')" title="Heading" aria-label="Heading">H2</button>
  <button class="ami-rte-btn" onclick="rteCmd('formatBlock','p')" title="Paragraph" aria-label="Paragraph">¬∂</button>
  <button class="ami-rte-btn" onclick="rteCmd('insertUnorderedList')" title="List" aria-label="Bullet list">‚Ä¢‚Äî</button>
  <div class="ami-rte-sep"></div>
  <button class="ami-rte-btn" onclick="rteCmd('createLink',prompt('URL:'))" title="Link" aria-label="Insert link">üîó</button>
  <button class="ami-rte-btn" onclick="rteCmd('unlink')" title="Remove link" aria-label="Remove link">‚úÇ</button>
</div>

<!-- Floating edit FAB -->
<button class="ami-edit-fab" id="amiEditFab" onclick="toggleEditMode()" aria-label="Toggle edit mode" style="display:none">
  <span class="fab-dot"></span>
  <span id="amiEditFabLabel">Edit Page</span>
</button>

<!-- Save bar -->
<div class="ami-edit-bar" id="amiEditBar" role="toolbar" aria-label="Edit mode controls">
  <span class="ami-edit-bar-label">‚úè Editing this page</span>
  <span class="ami-edit-pending none" id="amiPendingLabel">All saved</span>
  <button class="ami-save-btn" onclick="saveAllEdits()">üíæ Save All</button>
  <button class="ami-exit-btn" onclick="toggleEditMode()">Exit Edit Mode</button>
</div>

<!-- Image replace dialog -->
<div class="ami-img-dialog" id="amiImgDialog" role="dialog" aria-modal="true" aria-label="Replace image">
  <div class="ami-img-dialog-box">
    <div class="ami-img-dialog-title">üì∑ Replace Image</div>
    <img class="ami-img-dialog-preview" id="amiImgPreview" alt="Image preview">
    <div class="ami-img-dialog-tabs">
      <button class="ami-img-tab active" onclick="switchImgTab('url')" id="amiTabUrl">Paste URL</button>
      <button class="ami-img-tab" onclick="switchImgTab('upload')" id="amiTabUpload">Upload File</button>
    </div>
    <div class="ami-img-panel active" id="amiImgPanelUrl">
      <input class="ami-img-url" id="amiImgUrl" type="url" placeholder="https://example.com/image.jpg"
             oninput="previewImgUrl(this.value)">
    </div>
    <div class="ami-img-panel" id="amiImgPanelUpload">
      <div class="ami-img-upload-area">
        <input type="file" accept="image/*" id="amiImgFile" onchange="handleImgFileSelect(this)">
        <div class="ami-img-upload-label">üìÅ Click or drag to choose an image</div>
      </div>
    </div>
    <div class="ami-img-dialog-actions">
      <button class="ami-img-apply" onclick="applyImage()">Apply Image ‚Üí</button>
      <button class="ami-img-cancel" onclick="closeImgDialog()">Cancel</button>
    </div>
  </div>
</div>


<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AMI INLINE EDITOR ‚Äî Squarespace-style page editing
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
(function() {

var amiEditActive   = false;   // is edit mode on?
var amiPendingCount = 0;       // unsaved changes
var amiImgTarget    = null;    // current image element being replaced
var amiImgField     = null;    // its cms-key or article-field
var amiImgType      = null;    // 'setting' | 'article' | 'page'
var amiImgArticleId = null;    // for article images
var amiLastRteEl    = null;    // element rich-text bar is attached to
var amiUploadedUrl  = null;    // result of file upload

// ‚îÄ‚îÄ Show FAB after admin opens ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.amiShowEditFab = function() {
  var fab = document.getElementById('amiEditFab');
  if(fab) { fab.style.display = 'flex'; }
};
window.amiHideEditFab = function() {
  var fab = document.getElementById('amiEditFab');
  if(fab && !amiEditActive) fab.style.display = 'none';
};

// ‚îÄ‚îÄ Toggle Edit Mode ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.toggleEditMode = function() {
  amiEditActive ? exitEditMode() : enterEditMode();
};

function enterEditMode() {
  amiEditActive = true;
  document.body.classList.add('ami-edit-mode');
  document.getElementById('amiEditFabLabel').textContent = 'Editing‚Ä¶';
  document.getElementById('amiEditFab').classList.add('active');

  // Make static settings editable
  document.querySelectorAll('[data-editable="text"]').forEach(function(el) {
    el.setAttribute('contenteditable', 'true');
    el.setAttribute('spellcheck', 'true');
    el.dataset.originalContent = el.innerHTML;
    el.addEventListener('blur', onTextBlur);
    el.addEventListener('focus', onTextFocus);
    el.addEventListener('keydown', onEditKeydown);
  });

  // Rich-text elements (bodies, article body)
  document.querySelectorAll('[data-editable="richtext"]').forEach(function(el) {
    el.setAttribute('contenteditable', 'true');
    el.setAttribute('spellcheck', 'true');
    el.dataset.originalContent = el.innerHTML;
    el.addEventListener('blur', onRteBlur);
    el.addEventListener('focus', onRteFocus);
  });

  // Image elements
  document.querySelectorAll('[data-editable="image"]').forEach(function(el) {
    el.addEventListener('click', onImageClick);
    el.style.cursor = 'pointer';
  });

  // Add edit buttons to article cards (rendered dynamically)
  setupCardEditButtons();

  // Show save bar
  var bar = document.getElementById('amiEditBar');
  bar.classList.add('visible');
  updatePendingLabel();
}

function exitEditMode() {
  amiEditActive = false;
  document.body.classList.remove('ami-edit-mode');
  document.getElementById('amiEditFabLabel').textContent = 'Edit Page';
  document.getElementById('amiEditFab').classList.remove('active');

  // Disable contenteditable
  document.querySelectorAll('[contenteditable="true"]').forEach(function(el) {
    el.setAttribute('contenteditable', 'false');
    el.removeEventListener('blur', onTextBlur);
    el.removeEventListener('blur', onRteBlur);
    el.removeEventListener('focus', onTextFocus);
    el.removeEventListener('focus', onRteFocus);
    el.removeEventListener('keydown', onEditKeydown);
    el.removeEventListener('click', onImageClick);
  });

  // Remove image listeners
  document.querySelectorAll('[data-editable="image"]').forEach(function(el) {
    el.removeEventListener('click', onImageClick);
  });

  // Remove card edit buttons
  document.querySelectorAll('.card-edit-overlay').forEach(function(el) { el.remove(); });

  // Hide save bar & rte bar
  document.getElementById('amiEditBar').classList.remove('visible');
  document.getElementById('amiRteBar').classList.remove('visible');

  amiPendingCount = 0;
  updatePendingLabel();
}

// ‚îÄ‚îÄ Pending change tracking ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function addPending() {
  amiPendingCount++;
  updatePendingLabel();
}
function removePending() {
  if(amiPendingCount > 0) amiPendingCount--;
  updatePendingLabel();
}
function updatePendingLabel() {
  var el = document.getElementById('amiPendingLabel');
  if(!el) return;
  if(amiPendingCount === 0) {
    el.textContent = 'All saved ‚úì';
    el.className = 'ami-edit-pending none';
  } else {
    el.textContent = amiPendingCount + ' unsaved change' + (amiPendingCount !== 1 ? 's' : '');
    el.className = 'ami-edit-pending';
  }
}

// ‚îÄ‚îÄ Text field blur ‚Üí auto-save ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function onTextFocus(e) {
  // Select all text on first focus for easy replacement
}
function onEditKeydown(e) {
  if(e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    e.target.blur();
  }
  if(e.key === 'Escape') {
    // Restore original
    e.target.innerHTML = e.target.dataset.originalContent || '';
    e.target.blur();
  }
}
function onTextBlur(e) {
  var el = e.target;
  var newVal = el.textContent.trim();
  var oldVal = (el.dataset.originalContent || '').trim();
  if(newVal === oldVal) return;
  el.dataset.originalContent = el.innerHTML;
  var type    = el.dataset.cmsType;
  var key     = el.dataset.cmsKey;
  var artId   = el.dataset.articleId;
  var artFld  = el.dataset.articleField;
  var pageName= el.dataset.pageName;
  var pageFld = el.dataset.pageField;
  saveFieldChange(el, type, key, artId, artFld, pageName, pageFld, newVal);
}

// ‚îÄ‚îÄ Richtext blur ‚Üí auto-save ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function onRteFocus(e) {
  amiLastRteEl = e.target;
  document.getElementById('amiRteBar').classList.add('visible');
}
function onRteBlur(e) {
  // Small delay so clicking RTE bar buttons doesn't dismiss it
  setTimeout(function() {
    if(document.activeElement && document.activeElement.closest('.ami-rte-bar')) return;
    document.getElementById('amiRteBar').classList.remove('visible');
    amiLastRteEl = null;
    var el = e.target;
    var newVal = el.innerHTML.trim();
    var oldVal = (el.dataset.originalContent || '').trim();
    if(newVal === oldVal) return;
    el.dataset.originalContent = el.innerHTML;
    var type    = el.dataset.cmsType;
    var key     = el.dataset.cmsKey;
    var artId   = el.dataset.articleId;
    var artFld  = el.dataset.articleField;
    var pageName= el.dataset.pageName;
    var pageFld = el.dataset.pageField;
    saveFieldChange(el, type, key, artId, artFld, pageName, pageFld, newVal);
  }, 150);
}
window.rteCmd = function(cmd, val) {
  document.execCommand(cmd, false, val || null);
  if(amiLastRteEl) amiLastRteEl.focus();
};

// ‚îÄ‚îÄ Core save function ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function saveFieldChange(el, type, cmsKey, artId, artFld, pageName, pageFld, value) {
  addPending();
  try {
    if(type === 'setting') {
      // site_settings table
      await amiDbUpsertSetting(cmsKey, value);
    } else if(type === 'breaking') {
      // breaking_news table (update text)
      await amiDbUpdateBreaking(value);
    } else if(type === 'article' && artId && artFld) {
      // articles table
      var upd = {};
      upd[artFld] = value;
      await amiDbUpdateArticle(artId, upd);
    } else if(type === 'page' && pageName && pageFld) {
      // site_settings with page_${pageName}_${pageFld}
      await amiDbUpsertSetting('page_' + pageName + '_' + pageFld, value);
    }
    // Flash green
    el.classList.add('saved-flash');
    setTimeout(function() { el.classList.remove('saved-flash'); }, 800);
    removePending();
    if(typeof showToast === 'function') showToast('‚úì Saved');
  } catch(err) {
    removePending();
    addPending(); // keep as unsaved
    if(typeof showToast === 'function') showToast('‚úó Save failed: ' + err.message, 'error');
  }
}

// ‚îÄ‚îÄ Save All button ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.saveAllEdits = async function() {
  // Force blur on all active contenteditable elements
  document.querySelectorAll('[contenteditable="true"]').forEach(function(el) {
    if(document.activeElement === el) el.blur();
  });
  if(typeof showToast === 'function') showToast('‚úì All changes saved');
  amiPendingCount = 0;
  updatePendingLabel();
};

// ‚îÄ‚îÄ Image click ‚Üí open dialog ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function onImageClick(e) {
  e.preventDefault(); e.stopPropagation();
  var el      = e.currentTarget;
  amiImgTarget    = el;
  amiImgField     = el.dataset.cmsKey || el.dataset.articleField;
  amiImgType      = el.dataset.cmsType;
  amiImgArticleId = el.dataset.articleId;
  amiUploadedUrl  = null;
  // Show current image URL
  var currentSrc = el.src || el.getAttribute('data-src') || '';
  document.getElementById('amiImgUrl').value = currentSrc;
  document.getElementById('amiImgPreview').src = currentSrc;
  document.getElementById('amiImgPreview').style.display = currentSrc ? 'block' : 'none';
  switchImgTab('url');
  document.getElementById('amiImgDialog').classList.add('open');
}
window.switchImgTab = function(tab) {
  ['url','upload'].forEach(function(t) {
    document.getElementById('amiTabUrl' === 'amiTab' + t.charAt(0).toUpperCase() + t.slice(1) ||
      'amiTab' + t).classList.toggle('active', t === tab);
    document.getElementById('amiImgPanel' + t.charAt(0).toUpperCase() + t.slice(1)).classList.toggle('active', t === tab);
  });
  document.getElementById('amiTab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('active');
  document.getElementById('amiTabUrl' === 'amiTab' + (tab === 'url' ? 'Upload' : 'Url') ? 'x':'amiTab' +
    (tab === 'url' ? 'Upload' : 'Url')).classList.remove('active');
  document.getElementById('amiImgPanel' + (tab === 'url' ? 'Url' : 'Upload')).classList.add('active');
  document.getElementById('amiImgPanel' + (tab === 'url' ? 'Upload' : 'Url')).classList.remove('active');
};
window.previewImgUrl = function(url) {
  var prev = document.getElementById('amiImgPreview');
  if(url) { prev.src = url; prev.style.display = 'block'; } else { prev.style.display = 'none'; }
};
window.handleImgFileSelect = function(input) {
  var file = input.files[0]; if(!file) return;
  var prev = document.getElementById('amiImgPreview');
  var reader = new FileReader();
  reader.onload = function(e) { prev.src = e.target.result; prev.style.display = 'block'; };
  reader.readAsDataURL(file);
  // Upload to Supabase storage
  if(typeof db !== 'undefined' && db.uploadImage) {
    var path = 'inline/' + Date.now() + '-' + file.name;
    db.uploadImage(file, path).then(function(url) { amiUploadedUrl = url; })
      .catch(function(err) { if(typeof showToast === 'function') showToast('Upload failed: ' + err.message, 'error'); });
  }
};
window.closeImgDialog = function() {
  document.getElementById('amiImgDialog').classList.remove('open');
  amiImgTarget = amiImgField = amiImgType = amiImgArticleId = null;
};
window.applyImage = async function() {
  var url = amiUploadedUrl || document.getElementById('amiImgUrl').value.trim();
  if(!url) { closeImgDialog(); return; }
  // Update DOM immediately
  if(amiImgTarget) amiImgTarget.src = url;
  // Save to Supabase
  try {
    addPending();
    if(amiImgType === 'setting') {
      await amiDbUpsertSetting(amiImgField, url);
    } else if(amiImgType === 'article' && amiImgArticleId) {
      var upd = {}; upd[amiImgField] = url;
      await amiDbUpdateArticle(amiImgArticleId, upd);
    } else if(amiImgType === 'page' && amiImgField) {
      await amiDbUpsertSetting(amiImgField, url);
    }
    removePending();
    if(typeof showToast === 'function') showToast('‚úì Image updated');
  } catch(err) {
    if(typeof showToast === 'function') showToast('‚úó ' + err.message, 'error');
  }
  closeImgDialog();
};

// ‚îÄ‚îÄ Article card edit buttons ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setupCardEditButtons() {
  // Find all clickable article cards and add an edit overlay
  var clickEls = document.querySelectorAll('[onclick*="openArticle"]');
  clickEls.forEach(function(el) {
    // Only add to the card container, not nested elements
    if(el.classList.contains('article-card') ||
       el.classList.contains('hero-main') ||
       el.classList.contains('hero-side-1') ||
       el.classList.contains('hero-side-2')) {
      if(el.querySelector('.card-edit-overlay')) return;
      var match = (el.getAttribute('onclick') || '').match(/openArticle\((\d+)\)/);
      if(!match) return;
      var artId = match[1];
      var btn = document.createElement('button');
      btn.className = 'card-edit-overlay';
      btn.innerHTML = '‚úè Edit';
      btn.setAttribute('aria-label', 'Edit this article');
      btn.setAttribute('title', 'Edit this article in admin panel');
      btn.onclick = function(e) {
        e.stopPropagation();
        // Open admin panel and pre-select this article
        if(typeof openAdmin === 'function') openAdmin();
        setTimeout(function() {
          var editEl = document.getElementById('edit-' + artId);
          if(editEl) {
            editEl.classList.add('open');
            editEl.scrollIntoView({behavior:'smooth', block:'center'});
          }
        }, 400);
      };
      el.style.position = 'relative';
      el.appendChild(btn);
    }
  });
}

// ‚îÄ‚îÄ Supabase helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function amiDbUpsertSetting(key, value) {
  if(typeof SUPABASE_URL === 'undefined' || SUPABASE_URL === 'YOUR_SUPABASE_URL')
    throw new Error('Supabase not configured');
  var ANON = typeof SUPABASE_ANON !== 'undefined' ? SUPABASE_ANON : '';
  // Try update first, then insert
  var res = await fetch(SUPABASE_URL + '/rest/v1/site_settings?key=eq.' + encodeURIComponent(key), {
    method: 'PATCH',
    headers: {
      'apikey': ANON, 'Authorization': 'Bearer ' + ANON,
      'Content-Type': 'application/json', 'Prefer': 'return=minimal'
    },
    body: JSON.stringify({ key: key, value: value })
  });
  if(!res.ok) {
    // insert
    var res2 = await fetch(SUPABASE_URL + '/rest/v1/site_settings', {
      method: 'POST',
      headers: {
        'apikey': ANON, 'Authorization': 'Bearer ' + ANON,
        'Content-Type': 'application/json', 'Prefer': 'return=minimal'
      },
      body: JSON.stringify({ key: key, value: value })
    });
    if(!res2.ok) throw new Error(await res2.text());
  }
}
async function amiDbUpdateBreaking(text) {
  if(typeof SUPABASE_URL === 'undefined' || SUPABASE_URL === 'YOUR_SUPABASE_URL')
    throw new Error('Supabase not configured');
  var ANON = typeof SUPABASE_ANON !== 'undefined' ? SUPABASE_ANON : '';
  var res = await fetch(SUPABASE_URL + '/rest/v1/breaking_news?order=created_at.desc&limit=1', {
    headers: { 'apikey': ANON, 'Authorization': 'Bearer ' + ANON }
  });
  var rows = await res.json();
  if(rows && rows[0]) {
    await fetch(SUPABASE_URL + '/rest/v1/breaking_news?id=eq.' + rows[0].id, {
      method: 'PATCH',
      headers: {
        'apikey': ANON, 'Authorization': 'Bearer ' + ANON,
        'Content-Type': 'application/json', 'Prefer': 'return=minimal'
      },
      body: JSON.stringify({ text: text })
    });
  }
}
async function amiDbUpdateArticle(id, fields) {
  if(typeof SUPABASE_URL === 'undefined' || SUPABASE_URL === 'YOUR_SUPABASE_URL')
    throw new Error('Supabase not configured');
  var ANON = typeof SUPABASE_ANON !== 'undefined' ? SUPABASE_ANON : '';
  var res = await fetch(SUPABASE_URL + '/rest/v1/articles?id=eq.' + id, {
    method: 'PATCH',
    headers: {
      'apikey': ANON, 'Authorization': 'Bearer ' + ANON,
      'Content-Type': 'application/json', 'Prefer': 'return=minimal'
    },
    body: JSON.stringify(fields)
  });
  if(!res.ok) throw new Error(await res.text());
}

})(); // end IIFE
</script>

</body>
</html>
